openapi: 3.0.3
info:
  title: BThwani — Master API
  description: Aggregated OpenAPI skeleton built from per-service specifications.
  contact:
    name: BThwani Support
    email: support@bthwani.com
  version: 0.0.0-seed
servers:
  - url: https://api-dev.bthwani.com
    description: Dev
  - url: https://api-stage.bthwani.com
    description: Stage
  - url: https://api.bthwani.com
    description: Prod
x-built-from:
  - ../services/dsh/openapi.yaml
  - ../services/wlt/openapi.yaml
  - ../services/arb/openapi.yaml
  - ../services/esf/openapi.yaml
  - ../services/mrf/openapi.yaml
  - ../services/knz/openapi.yaml
  - ../services/amn/openapi.yaml
  - ../services/snd/openapi.yaml
  - ../services/kwd/openapi.yaml
tags:
  - name: Checkout
    description: عمليات إنشاء وتأكيد الطلبات وفترات الـ Dark-Store.
  - name: Orders
    description: إدارة الطلبات، تفاصيلها، وإلغائها.
  - name: Tracking
    description: تتبع الطلب، الخط الزمني، وإثبات التسليم.
  - name: Chat
    description: محادثات الطلب وإشعارات القراءة.
  - name: Notes
    description: ملاحظات الطلب المشفرة والمقنّعة.
  - name: PartnerInfo
    description: سياسات ومناطق تغطية المتاجر الشريكة.
  - name: PartnerOrders
    description: عمليات إدارة الطلبات عبر تطبيق الشريك.
  - name: PartnerChat
    description: دردشة الشريك ومؤشرات القراءة.
  - name: PartnerNotes
    description: ملاحظات الطلب من منظور الشريك.
  - name: PartnerConfig
    description: إعدادات الشريك (سياسات، مناطق، فترات، مخزون، إيصالات).
  - name: PartnerSystem
    description: تكاملات النظام المرتبطة بتطبيق الشريك.
  - name: CaptainOrders
    description: إدارة الطلبات وتقدمها من منظور الكابتن.
  - name: CaptainChat
    description: دردشة الكابتن ومؤشرات القراءة.
  - name: CaptainProfile
    description: توافر الكابتن، الإحداثيات، وسجلات الأرباح.
  - name: CaptainSystem
    description: Webhooks وتكاملات مرتبطة بتطبيق الكابتن.
  - name: FieldIntake
    description: إدخال بيانات الشريك والمستندات عبر التطبيق الميداني.
  - name: FieldStores
    description: إنشاء وتحديث المتاجر وإعداد مناطقها عبر التطبيق الميداني.
  - name: FieldConfig
    description: ضبط سياسات العمولة والبنوك ودعوات المستخدمين من التطبيق الميداني.
  - name: FieldReview
    description: إدارة قائمة الانتظار واعتماد/رفض الشركاء.
  - name: System
    description: تكاملات النظام (إشعارات، Webhooks).
  - name: PaymentIntents
    description: إدارة عمليات إنشاء واستعلام نوايا الدفع.
  - name: PaymentConfirmations
    description: تأكيد عمليات الدفع بعد موفري PSP.
  - name: Settlements
    description: تسويات وضبط مبالغ الالتقاط (capture) بعد التعديلات.
  - name: WalletWebhooks
    description: Webhooks صادرة من WLT إلى الخدمات الأخرى (مثل DSH) حول الاستردادات.
  - name: APP-CAPTAIN
  - name: APP-FIELD
  - name: APP-PARTNER
  - name: APP-USER
  - name: DASH-ADMIN
  - name: DASH-BI
  - name: DASH-CRM
  - name: DASH-FIN
  - name: DASH-FLEET
  - name: DASH-HR
  - name: DASH-MKT
  - name: DASH-OPS
  - name: DASH-PARTNER
  - name: DASH-QA
  - name: DASH-SSOT
  - name: DASH-SUPPORT
  - name: SYSTEM
  - name: admin.audit
  - name: admin.decisions
  - name: admin.feature_flags
  - name: admin.partners
  - name: admin.runtime_vars
  - name: admin.users
paths:
  /admin/audit/logs:
    get:
      operationId: dash_admin_audit_search
      responses:
        "200":
          description: Search audit logs by entity/action/date
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuditLogList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-ADMIN
      summary: Search audit logs by entity/action/date
      description: Search audit logs by entity/action/date
      x-action-id: search_audit
      x-entity-code: DASH-ADMIN
      x-guards: PASS(Allowlist,Problem,Pagination,Auth)
      x-rbac-role: admin
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
      x-alternate-operations:
        - operationId: admin_audit_logs_list
          summary: List audit logs with filters.
          description: List audit logs with filters.
          surface: admin.audit
          rbac_role: admin
          guards: PASS(Allowlist,Problem,Pagination)
          action_id: list_audit
          entity_code: ""
  /admin/decisions:
    get:
      operationId: admin_decisions_list
      responses:
        "200":
          description: List governance decisions and statuses.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DecisionList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - admin.decisions
      summary: List governance decisions and statuses.
      description: List governance decisions and statuses.
      x-action-id: list_decisions
      x-guards: PASS(Allowlist,Problem,Pagination)
      x-rbac-role: admin
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
  /admin/dls/orders:
    get:
      operationId: dash_admin_orders_list
      responses:
        "200":
          description: List platform orders with filters
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AdminOrderList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-ADMIN
      summary: List platform orders with filters
      description: List platform orders with filters
      x-action-id: list_orders
      x-entity-code: DASH-ADMIN
      x-guards: PASS(Allowlist,Problem,Pagination,Auth)
      x-rbac-role: admin
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
  /admin/dls/orders/{order_id}:
    get:
      operationId: dash_admin_orders_get
      responses:
        "200":
          description: Get order details with audit trail
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OrderAdminView"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-ADMIN
      summary: Get order details with audit trail
      description: Get order details with audit trail
      x-action-id: get_order
      x-entity-code: DASH-ADMIN
      x-guards: PASS(Allowlist,Problem,PathParam,Auth)
      x-rbac-role: admin
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
  /admin/feature-flags:
    get:
      operationId: admin_feature_flags_list
      responses:
        "200":
          description: List feature flags with environment and scope.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FeatureFlagList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - admin.feature_flags
      summary: List feature flags with environment and scope.
      description: List feature flags with environment and scope.
      x-action-id: list_feature_flags
      x-guards: PASS(Allowlist,Problem,Pagination)
      x-rbac-role: admin
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
  /admin/feature-flags/{flag}/toggle:
    post:
      operationId: admin_feature_flag_toggle
      responses:
        "200":
          description: Toggle a feature flag on/off for a scope.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FeatureFlag"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - admin.feature_flags
      summary: Toggle a feature flag on/off for a scope.
      description: Toggle a feature flag on/off for a scope.
      x-action-id: toggle_feature_flag
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Audit-Immutable,Step-Up)
      x-rbac-role: admin
      parameters:
        - name: flag
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/FeatureFlagToggleRequest"
  /admin/fin/settlements:
    post:
      operationId: dash_admin_fin_settlement_create
      responses:
        "201":
          description: Create vendor settlement batch (dual-sign required)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SettlementBatch"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-ADMIN
      summary: Create vendor settlement batch (dual-sign required)
      description: Create vendor settlement batch (dual-sign required)
      x-action-id: create_batch
      x-entity-code: DASH-ADMIN
      x-guards: PASS(Idem,Allowlist,Problem,Auth,Step-Up)
      x-rbac-role: finance
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SettlementCreateRequest"
  /admin/fin/settlements/{batch_id}/approve:
    post:
      operationId: dash_admin_fin_settlement_approve
      responses:
        "200":
          description: Approve settlement batch (dual-sign)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SettlementBatch"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-ADMIN
      summary: Approve settlement batch (dual-sign)
      description: Approve settlement batch (dual-sign)
      x-action-id: approve_batch
      x-entity-code: DASH-ADMIN
      x-guards: PASS(Idem,Allowlist,Problem,Auth,Step-Up,Audit-Immutable)
      x-rbac-role: finance
      parameters:
        - name: batch_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SettlementApproveRequest"
  /admin/metrics:
    get:
      operationId: dash_admin_metrics_get
      responses:
        "200":
          description: Admin overview metrics
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DashboardMetrics"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-ADMIN
      summary: Admin overview metrics
      description: Admin overview metrics
      x-action-id: load_metrics
      x-entity-code: DASH-ADMIN
      x-guards: PASS(Allowlist,Problem,Auth)
      x-rbac-role: admin
  /admin/partners:
    get:
      operationId: dash_admin_partners_list
      responses:
        "200":
          description: List partners with filters
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PartnerList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-ADMIN
      summary: List partners with filters
      description: List partners with filters
      x-action-id: list_partners
      x-entity-code: DASH-ADMIN
      x-guards: PASS(Allowlist,Problem,Pagination,Auth)
      x-rbac-role: admin
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
      x-alternate-operations:
        - operationId: admin_partners_list
          summary: List partners with filters and pagination.
          description: List partners with filters and pagination.
          surface: admin.partners
          rbac_role: admin
          guards: PASS(Allowlist,Problem,Pagination)
          action_id: list_partners
          entity_code: ""
    post:
      operationId: dash_admin_partners_create
      responses:
        "201":
          description: Create partner account
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Partner"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-ADMIN
      summary: Create partner account
      description: Create partner account
      x-action-id: create_partner
      x-entity-code: DASH-ADMIN
      x-guards: PASS(Idem,Allowlist,Problem,Auth)
      x-rbac-role: admin
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PartnerCreateRequest"
  /admin/partners/{partner_id}:
    get:
      operationId: admin_partner_get
      responses:
        "200":
          description: Load partner details including policies/zones.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AdminPartner"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - admin.partners
      summary: Load partner details including policies/zones.
      description: Load partner details including policies/zones.
      x-action-id: load_partner
      x-guards: PASS(Allowlist,Problem,PathParam)
      x-rbac-role: admin
      parameters:
        - name: partner_id
          in: path
          required: true
          schema:
            type: string
    patch:
      operationId: dash_admin_partners_update
      responses:
        "200":
          description: Update partner profile and policies
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Partner"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-ADMIN
      summary: Update partner profile and policies
      description: Update partner profile and policies
      x-action-id: update_partner
      x-entity-code: DASH-ADMIN
      x-guards: PASS(Idem,Allowlist,Problem,Auth,PathParam)
      x-rbac-role: admin
      parameters:
        - name: partner_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PartnerUpdateRequest"
  /admin/partners/{partner_id}/approve:
    post:
      operationId: admin_partner_approve
      responses:
        "200":
          description: Approve partner after KYC review.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AdminPartner"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - admin.partners
      summary: Approve partner after KYC review.
      description: Approve partner after KYC review.
      x-action-id: approve_partner
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Audit-Immutable,Step-Up)
      x-rbac-role: admin
      parameters:
        - name: partner_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AdminPartnerApproveRequest"
  /admin/partners/{partner_id}/reject:
    post:
      operationId: admin_partner_reject
      responses:
        "200":
          description: Reject partner application with reason.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AdminPartner"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - admin.partners
      summary: Reject partner application with reason.
      description: Reject partner application with reason.
      x-action-id: reject_partner
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Audit-Immutable,Step-Up)
      x-rbac-role: admin
      parameters:
        - name: partner_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AdminPartnerRejectRequest"
  /admin/runtime/vars:
    get:
      operationId: admin_runtime_vars_list
      responses:
        "200":
          description: List runtime variables with scope precedence.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RuntimeVarList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - admin.runtime_vars
      summary: List runtime variables with scope precedence.
      description: List runtime variables with scope precedence.
      x-action-id: list_runtime_vars
      x-guards: PASS(Allowlist,Problem,Pagination)
      x-rbac-role: admin
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
    patch:
      operationId: dash_admin_runtime_vars_update
      responses:
        "200":
          description: Update runtime VAR_* with audit and previews
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RuntimeVars"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-ADMIN
      summary: Update runtime VAR_* with audit and previews
      description: Update runtime VAR_* with audit and previews
      x-action-id: update_vars
      x-entity-code: DASH-ADMIN
      x-guards: PASS(Idem,Allowlist,Problem,Auth,Audit-Immutable)
      x-rbac-role: admin
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RuntimeVarsPatch"
  /admin/runtime/vars/{key}:
    put:
      operationId: admin_runtime_var_upsert
      responses:
        "200":
          description: Create or update a runtime variable.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RuntimeVar"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - admin.runtime_vars
      summary: Create or update a runtime variable.
      description: Create or update a runtime variable.
      x-action-id: upsert_runtime_var
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Audit-Immutable,Step-Up)
      x-rbac-role: admin
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RuntimeVarUpsertRequest"
    delete:
      operationId: admin_runtime_var_delete
      responses:
        "204":
          description: Delete a runtime variable.
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - admin.runtime_vars
      summary: Delete a runtime variable.
      description: Delete a runtime variable.
      x-action-id: delete_runtime_var
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Audit-Immutable,Step-Up)
      x-rbac-role: admin
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
  /admin/security/rotate-keys:
    post:
      operationId: dash_admin_security_rotate_keys
      responses:
        "200":
          description: Rotate keys; enforce vault storage; record audit
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/KeyRotationResult"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-ADMIN
      summary: Rotate keys; enforce vault storage; record audit
      description: Rotate keys; enforce vault storage; record audit
      x-action-id: rotate_keys
      x-entity-code: DASH-ADMIN
      x-guards: PASS(Idem,Allowlist,Problem,Auth,Step-Up,Audit-Immutable)
      x-rbac-role: security
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/KeyRotationRequest"
  /admin/users:
    get:
      operationId: admin_users_list
      responses:
        "200":
          description: List users with roles and status.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AdminUserList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - admin.users
      summary: List users with roles and status.
      description: List users with roles and status.
      x-action-id: list_users
      x-guards: PASS(Allowlist,Problem,Pagination)
      x-rbac-role: admin
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
  /admin/users/{user_id}/roles:
    post:
      operationId: admin_user_role_assign
      responses:
        "200":
          description: Assign or update user roles with step-up.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AdminUser"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - admin.users
      summary: Assign or update user roles with step-up.
      description: Assign or update user roles with step-up.
      x-action-id: assign_role
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Audit-Immutable,Step-Up)
      x-rbac-role: admin
      parameters:
        - name: user_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AssignRoleRequest"
  /api/bi/alerts:
    get:
      operationId: bi_alerts_list
      description: Fetches BI alert definitions the analyst is allowed to view with pagination.
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AlertList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-BI
      x-action-id: list_alerts
      x-guards: PASS(Allowlist,Problem,Pagination)
      x-rbac-role: analyst
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
    post:
      operationId: bi_alerts_create
      description: Creates a new BI alert configuration with optional delivery targets.
      responses:
        "201":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Alert"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-BI
      x-action-id: create_alert
      x-guards: PASS(Idem,Allowlist,Problem,Security)
      x-rbac-role: analyst
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AlertCreateRequest"
  /api/bi/alerts/{id}:
    patch:
      operationId: bi_alerts_update
      description: Updates thresholds or metadata for an existing BI alert.
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Alert"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-BI
      x-action-id: update_alert
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Security)
      x-rbac-role: analyst
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AlertUpdateRequest"
  /api/bi/dashboards:
    get:
      operationId: bi_dashboards_list
      description: Lists published dashboards available to the analyst, ordered by recency.
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DashboardList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-BI
      x-action-id: list_dashboards
      x-guards: PASS(Allowlist,Problem,Pagination)
      x-rbac-role: analyst
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
  /api/bi/dashboards/{id}:
    get:
      operationId: bi_dashboards_get
      description: Returns the widget layout and metadata for a single dashboard.
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Dashboard"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-BI
      x-action-id: load_dashboard
      x-guards: PASS(Allowlist,Problem,PathParam)
      x-rbac-role: analyst
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
  /api/bi/exports:
    post:
      operationId: bi_exports_create
      description: Kicks off an asynchronous data export job and returns its tracking info.
      responses:
        "201":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ExportJob"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-BI
      x-action-id: request_export
      x-guards: PASS(Idem,Allowlist,Problem,Security,Privacy-Export)
      x-rbac-role: analyst
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ExportRequest"
  /api/bi/exports/{job_id}:
    get:
      operationId: bi_exports_get
      description: Retrieves the status and download link for a previously requested export job.
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ExportJob"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-BI
      x-action-id: poll_export
      x-guards: PASS(Allowlist,Problem,PathParam)
      x-rbac-role: analyst
      parameters:
        - name: job_id
          in: path
          required: true
          schema:
            type: string
  /api/bi/metrics:
    get:
      operationId: bi_metrics_list
      description: Returns summary metric cards and trends for the selected analytics scope.
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MetricList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-BI
      x-action-id: list_metrics
      x-guards: PASS(Allowlist,Problem,Pagination)
      x-rbac-role: analyst
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
  /api/bi/queries:
    get:
      operationId: bi_queries_list
      description: Lists saved analytic queries available to the analyst with pagination.
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/QueryList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-BI
      x-action-id: list_queries
      x-guards: PASS(Allowlist,Problem,Pagination)
      x-rbac-role: analyst
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
  /api/bi/queries/run:
    post:
      operationId: bi_query_run
      description: Executes a saved or ad-hoc BI query and returns its run ticket and preview.
      responses:
        "202":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/QueryRunResult"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-BI
      x-action-id: run_query
      x-guards: PASS(Idem,Allowlist,Problem,Security)
      x-rbac-role: analyst
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/QueryRunRequest"
  /api/bi/reports:
    get:
      operationId: bi_reports_list
      description: Lists scheduled BI reports with cursor pagination for the analyst.
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ReportList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-BI
      x-action-id: list_reports
      x-guards: PASS(Allowlist,Problem,Pagination)
      x-rbac-role: analyst
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
    post:
      operationId: bi_reports_create
      description: Creates a new scheduled BI report definition with delivery settings.
      responses:
        "201":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Report"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-BI
      x-action-id: create_report
      x-guards: PASS(Idem,Allowlist,Problem,Security)
      x-rbac-role: analyst
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ReportCreateRequest"
  /api/crm/customers:
    get:
      operationId: crm_customers_search
      responses:
        "200":
          description: Search customers, masked PII, cursor pagination.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CustomerList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-CRM
      summary: Search customers, masked PII, cursor pagination.
      description: Search customers, masked PII, cursor pagination.
      x-action-id: search
      x-entity-code: DASH-CRM
      x-guards: PASS(Allowlist,Problem,Pagination,Masking)
      x-rbac-role: support
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
  /api/crm/customers/{customer_id}:
    get:
      operationId: crm_customer_get
      responses:
        "200":
          description: Customer profile with masking and role-based reveal.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Customer"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-CRM
      summary: Customer profile with masking and role-based reveal.
      description: Customer profile with masking and role-based reveal.
      x-action-id: details
      x-entity-code: DASH-CRM
      x-guards: PASS(Allowlist,Problem,PathParam,Masking)
      x-rbac-role: support
      parameters:
        - name: customer_id
          in: path
          required: true
          schema:
            type: string
  /api/crm/customers/{customer_id}/unmask-request:
    post:
      operationId: crm_customer_unmask_request
      responses:
        "200":
          description: Create controlled unmask request; requires Step-Up and auditing.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UnmaskTicket"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-CRM
      summary: Create controlled unmask request; requires Step-Up and auditing.
      description: Create controlled unmask request; requires Step-Up and auditing.
      x-action-id: request_unmask
      x-entity-code: DASH-CRM
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Step-Up,Audit-Immutable)
      x-rbac-role: support
      parameters:
        - name: customer_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UnmaskRequest"
  /api/crm/exports/masked:
    post:
      operationId: crm_export_masked
      responses:
        "201":
          description: Start masked export; Privacy-Export enforced.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ExportTask"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-CRM
      summary: Start masked export; Privacy-Export enforced.
      description: Start masked export; Privacy-Export enforced.
      x-action-id: export_masked
      x-entity-code: DASH-CRM
      x-guards: PASS(Idem,Allowlist,Problem,Privacy-Export)
      x-rbac-role: support
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ExportRequest"
  /api/crm/exports/unmasked/dry-run:
    post:
      operationId: crm_export_unmasked_dryrun
      responses:
        "201":
          description: Dry-run only unmasked export; blocked in Sensitive Mode.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ExportDryRun"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-CRM
      summary: Dry-run only unmasked export; blocked in Sensitive Mode.
      description: Dry-run only unmasked export; blocked in Sensitive Mode.
      x-action-id: export_unmasked_dryrun
      x-entity-code: DASH-CRM
      x-guards: PASS(Idem,Allowlist,Problem,Step-Up,OPA-Guard)
      x-rbac-role: admin
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ExportRequest"
  /api/crm/inbound/messages:
    post:
      operationId: crm_inbound_webhook
      responses:
        "200":
          description: Inbound provider messages; signature + anti-replay enforced.
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security: []
      tags:
        - DASH-CRM
      summary: Inbound provider messages; signature + anti-replay enforced.
      description: Inbound provider messages; signature + anti-replay enforced.
      x-action-id: inbound_webhook
      x-entity-code: DASH-CRM
      x-guards: PASS(Webhook-HMAC,Anti-Replay≤300s,Allowlist,Problem,Audit-Immutable)
      x-rbac-role: system
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/InboundMessage"
  /api/crm/reports:
    get:
      operationId: crm_reports_list
      responses:
        "200":
          description: List available CRM reports.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ReportList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-CRM
      summary: List available CRM reports.
      description: List available CRM reports.
      x-action-id: list
      x-entity-code: DASH-CRM
      x-guards: PASS(Allowlist,Problem,Pagination)
      x-rbac-role: support
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
    post:
      operationId: crm_reports_generate
      responses:
        "201":
          description: Generate a report; background job id returned.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Report"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-CRM
      summary: Generate a report; background job id returned.
      description: Generate a report; background job id returned.
      x-action-id: generate
      x-entity-code: DASH-CRM
      x-guards: PASS(Idem,Allowlist,Problem)
      x-rbac-role: support
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ReportGenRequest"
  /api/crm/tickets:
    get:
      operationId: crm_tickets_list
      responses:
        "200":
          description: List tickets with cursor pagination; masked PII.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TicketList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-CRM
      summary: List tickets with cursor pagination; masked PII.
      description: List tickets with cursor pagination; masked PII.
      x-action-id: load_inbox
      x-entity-code: DASH-CRM
      x-guards: PASS(Allowlist,Problem,Pagination,Masking)
      x-rbac-role: support
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
  /api/crm/tickets/{ticket_id}:
    get:
      operationId: crm_ticket_get
      responses:
        "200":
          description: Get ticket details and timeline.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Ticket"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-CRM
      summary: Get ticket details and timeline.
      description: Get ticket details and timeline.
      x-action-id: open_ticket
      x-entity-code: DASH-CRM
      x-guards: PASS(Allowlist,Problem,PathParam,Masking)
      x-rbac-role: support
      parameters:
        - name: ticket_id
          in: path
          required: true
          schema:
            type: string
  /api/crm/tickets/{ticket_id}/assign:
    post:
      operationId: crm_ticket_assign
      responses:
        "200":
          description: Assign ticket to agent; step-up may be required.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Ticket"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-CRM
      summary: Assign ticket to agent; step-up may be required.
      description: Assign ticket to agent; step-up may be required.
      x-action-id: assign_owner
      x-entity-code: DASH-CRM
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Step-Up)
      x-rbac-role: support
      parameters:
        - name: ticket_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AssignRequest"
  /api/crm/tickets/{ticket_id}/messages:
    post:
      operationId: crm_ticket_reply
      responses:
        "200":
          description: Post a masked reply; AES-GCM field encryption; audit log.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ChatMessage"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-CRM
      summary: Post a masked reply; AES-GCM field encryption; audit log.
      description: Post a masked reply; AES-GCM field encryption; audit log.
      x-action-id: reply
      x-entity-code: DASH-CRM
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Masking,Audit-Immutable)
      x-rbac-role: support
      parameters:
        - name: ticket_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CrmReplyRequest"
  /api/crm/tickets/{ticket_id}/read-ack:
    post:
      operationId: crm_ticket_read_ack
      responses:
        "200":
          description: Acknowledge messages as read.
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-CRM
      summary: Acknowledge messages as read.
      description: Acknowledge messages as read.
      x-action-id: ack_read
      x-entity-code: DASH-CRM
      x-guards: PASS(Idem,Allowlist,Problem,PathParam)
      x-rbac-role: support
      parameters:
        - name: ticket_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChatReadAckRequest"
  /api/crm/tickets/{ticket_id}/tags:
    patch:
      operationId: crm_ticket_tags_update
      responses:
        "200":
          description: Update tags.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Ticket"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-CRM
      summary: Update tags.
      description: Update tags.
      x-action-id: update_tags
      x-entity-code: DASH-CRM
      x-guards: PASS(Idem,Allowlist,Problem,PathParam)
      x-rbac-role: support
      parameters:
        - name: ticket_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TagsUpdateRequest"
  /api/crm/unmask/{request_id}/approve:
    post:
      operationId: crm_customer_unmask_approve
      responses:
        "200":
          description: Approve unmask after dual control.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UnmaskTicket"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-CRM
      summary: Approve unmask after dual control.
      description: Approve unmask after dual control.
      x-action-id: approve_unmask
      x-entity-code: DASH-CRM
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Step-Up)
      x-rbac-role: admin
      parameters:
        - name: request_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UnmaskApproval"
  /api/dls/cancel-reasons:
    get:
      operationId: dls_cancel_reasons_list
      responses:
        "200":
          description: List allowed cancel reasons.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CancelReasonList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-USER
      summary: List allowed cancel reasons.
      description: List allowed cancel reasons.
      x-action-id: dls_cancel_reasons_list
      x-entity-code: SRV-DSH-01
      x-guards: PASS
      x-rbac-role: user
  /api/dls/captain/availability:
    post:
      operationId: dls_cap_availability_set
      responses:
        "200":
          description: Set on-duty/off-duty and service zones.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CaptainAvailability"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-CAPTAIN
      summary: Set on-duty/off-duty and service zones.
      description: Set on-duty/off-duty and service zones.
      x-action-id: set_availability
      x-guards: PASS(Idem,Allowlist,Problem)
      x-rbac-role: captain
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CaptainAvailability"
  /api/dls/captain/earnings:
    get:
      operationId: dls_cap_earnings_get
      responses:
        "200":
          description: Captain earnings summary.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CaptainEarnings"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-CAPTAIN
      summary: Captain earnings summary.
      description: Captain earnings summary.
      x-action-id: load_earnings
      x-guards: PASS(Allowlist,Problem)
      x-rbac-role: captain
  /api/dls/captain/location:
    post:
      operationId: dls_cap_location_update
      responses:
        "200":
          description: Periodic captain location heartbeat.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LocationAck"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-CAPTAIN
      summary: Periodic captain location heartbeat.
      description: Periodic captain location heartbeat.
      x-action-id: update_location
      x-guards: PASS(Idem,Allowlist,Problem)
      x-rbac-role: captain
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CaptainLocationUpdate"
  /api/dls/captain/orders:
    get:
      operationId: dls_cap_orders_list
      responses:
        "200":
          description: List assigned/available orders for captain (cursor/limit).
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CaptainOrderList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-CAPTAIN
      summary: List assigned/available orders for captain (cursor/limit).
      description: List assigned/available orders for captain (cursor/limit).
      x-action-id: list_orders
      x-guards: PASS(Allowlist,Problem,Pagination)
      x-rbac-role: captain
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
  /api/dls/captain/orders/{order_id}:
    get:
      operationId: dls_cap_orders_get
      responses:
        "200":
          description: Get order details and current state.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CaptainOrder"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-CAPTAIN
      summary: Get order details and current state.
      description: Get order details and current state.
      x-action-id: load_order
      x-guards: PASS(Allowlist,Problem,PathParam)
      x-rbac-role: captain
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
  /api/dls/captain/orders/{order_id}/accept:
    post:
      operationId: dls_cap_orders_accept
      responses:
        "200":
          description: Accept an available order.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CaptainOrder"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-CAPTAIN
      summary: Accept an available order.
      description: Accept an available order.
      x-action-id: accept_order
      x-guards: PASS(Idem,Allowlist,Problem,PathParam)
      x-rbac-role: captain
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CaptainAcceptRequest"
  /api/dls/captain/orders/{order_id}/arrived-customer:
    post:
      operationId: dls_cap_orders_arrived_customer
      responses:
        "200":
          description: Mark arrived at customer location.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CaptainOrder"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-CAPTAIN
      summary: Mark arrived at customer location.
      description: Mark arrived at customer location.
      x-action-id: arrived_customer
      x-guards: PASS(Idem,Allowlist,Problem,PathParam)
      x-rbac-role: captain
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CaptainArrivedCustomer"
  /api/dls/captain/orders/{order_id}/arrived-store:
    post:
      operationId: dls_cap_orders_arrived_store
      responses:
        "200":
          description: Mark arrived at store.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CaptainOrder"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-CAPTAIN
      summary: Mark arrived at store.
      description: Mark arrived at store.
      x-action-id: arrived_store
      x-guards: PASS(Idem,Allowlist,Problem,PathParam)
      x-rbac-role: captain
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CaptainArrivedStore"
  /api/dls/captain/orders/{order_id}/chat/messages:
    get:
      operationId: dls_cap_chat_list
      responses:
        "200":
          description: Chat history with masking and pagination.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ChatList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-CAPTAIN
      summary: Chat history with masking and pagination.
      description: Chat history with masking and pagination.
      x-action-id: list_messages
      x-guards: PASS(Allowlist,Problem,PathParam,Pagination,Masking)
      x-rbac-role: captain
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
    post:
      operationId: dls_cap_chat_send
      responses:
        "200":
          description: Send chat message with phone/links masking.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ChatMessage"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-CAPTAIN
      summary: Send chat message with phone/links masking.
      description: Send chat message with phone/links masking.
      x-action-id: send_message
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Masking)
      x-rbac-role: captain
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChatSendRequest"
  /api/dls/captain/orders/{order_id}/chat/read-ack:
    post:
      operationId: dls_cap_chat_read_ack
      responses:
        "200":
          description: Mark chat messages as read.
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-CAPTAIN
      summary: Mark chat messages as read.
      description: Mark chat messages as read.
      x-action-id: ack_read
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Masking)
      x-rbac-role: captain
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChatReadAckRequest"
  /api/dls/captain/orders/{order_id}/delivered:
    post:
      operationId: dls_cap_orders_delivered
      responses:
        "200":
          description: Close order with PoD code when required.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CaptainOrder"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-CAPTAIN
      summary: Close order with PoD code when required.
      description: Close order with PoD code when required.
      x-action-id: delivered_pod
      x-guards: PASS(Idem,Allowlist,Problem,PathParam)
      x-rbac-role: captain
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CaptainDeliveredRequest"
  /api/dls/captain/orders/{order_id}/picked-up:
    post:
      operationId: dls_cap_orders_picked_up
      responses:
        "200":
          description: Confirm items picked up.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CaptainOrder"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-CAPTAIN
      summary: Confirm items picked up.
      description: Confirm items picked up.
      x-action-id: picked_up
      x-guards: PASS(Idem,Allowlist,Problem,PathParam)
      x-rbac-role: captain
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CaptainPickedUp"
  /api/dls/captain/orders/{order_id}/reject:
    post:
      operationId: dls_cap_orders_reject
      responses:
        "200":
          description: Reject an offered order.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CaptainOrder"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-CAPTAIN
      summary: Reject an offered order.
      description: Reject an offered order.
      x-action-id: reject_order
      x-guards: PASS(Idem,Allowlist,Problem,PathParam)
      x-rbac-role: captain
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CaptainRejectRequest"
  /api/dls/captain/orders/{order_id}/timeline:
    get:
      operationId: dls_cap_orders_timeline_get
      responses:
        "200":
          description: View order event timeline.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OrderTimeline"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-CAPTAIN
      summary: View order event timeline.
      description: View order event timeline.
      x-action-id: view_timeline
      x-guards: PASS(Allowlist,Problem,PathParam)
      x-rbac-role: captain
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
  /api/dls/inbound/messages:
    post:
      operationId: dls_inbound_messages_webhook
      responses:
        "200":
          description: Inbound provider messages webhook.
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security: []
      tags:
        - SYSTEM
        - APP-USER
      summary: Inbound provider messages webhook.
      description: Inbound provider messages webhook.
      x-action-id: inbound_msg_webhook
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Webhook-HMAC,Anti-Replay≤300s,Allowlist,Problem,Audit-Immutable)
      x-rbac-role: system
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/InboundMessageWebhook"
  /api/dls/orders:
    get:
      operationId: dls_orders_list
      responses:
        "200":
          description: List user orders with pagination.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OrderList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-USER
      summary: List user orders with pagination.
      description: List user orders with pagination.
      x-action-id: dls_orders_list
      x-entity-code: SRV-DSH-01
      x-guards: PASS
      x-rbac-role: user
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
    post:
      operationId: dls_orders_create
      responses:
        "201":
          description: Create order according to channel and payment.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Order"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-USER
      summary: Create order according to channel and payment.
      description: Create order according to channel and payment.
      x-action-id: dls_orders_create
      x-entity-code: SRV-DSH-01
      x-guards: PASS
      x-rbac-role: user
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/OrderCreateRequest"
  /api/dls/orders/{order_id}:
    get:
      operationId: dls_orders_get
      responses:
        "200":
          description: Get order details including state history.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Order"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-USER
      summary: Get order details including state history.
      description: Get order details including state history.
      x-action-id: dls_orders_get
      x-entity-code: SRV-DSH-01
      x-guards: PASS
      x-rbac-role: user
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
    patch:
      operationId: dls_orders_update
      responses:
        "200":
          description: Confirm Dark-Store slot or update order minor fields.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Order"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-USER
      summary: Confirm Dark-Store slot or update order minor fields.
      description: Confirm Dark-Store slot or update order minor fields.
      x-action-id: dls_orders_update
      x-entity-code: SRV-DSH-01
      x-guards: PASS
      x-rbac-role: user
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/OrderUpdateRequest"
  /api/dls/orders/{order_id}/cancel:
    post:
      operationId: dls_orders_cancel
      responses:
        "200":
          description: Cancel order within free window if allowed.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Order"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-USER
      summary: Cancel order within free window if allowed.
      description: Cancel order within free window if allowed.
      x-action-id: dls_orders_cancel
      x-entity-code: SRV-DSH-01
      x-guards: PASS
      x-rbac-role: user
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/OrderCancelRequest"
  /api/dls/orders/{order_id}/chat/messages:
    get:
      operationId: dls_chat_list
      responses:
        "200":
          description: List chat messages with cursor pagination.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ChatList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-USER
      summary: List chat messages with cursor pagination.
      description: List chat messages with cursor pagination.
      x-action-id: dls_chat_list
      x-entity-code: SRV-DSH-01
      x-guards: PASS
      x-rbac-role: user
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
    post:
      operationId: dls_chat_send
      responses:
        "200":
          description: Send chat message with masking and field encryption.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ChatMessage"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-USER
      summary: Send chat message with masking and field encryption.
      description: Send chat message with masking and field encryption.
      x-action-id: dls_chat_send
      x-entity-code: SRV-DSH-01
      x-guards: PASS
      x-rbac-role: user
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChatSendRequest"
  /api/dls/orders/{order_id}/chat/read-ack:
    post:
      operationId: dls_chat_read_ack
      responses:
        "200":
          description: Acknowledge chat messages as read.
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-USER
      summary: Acknowledge chat messages as read.
      description: Acknowledge chat messages as read.
      x-action-id: dls_chat_read_ack
      x-entity-code: SRV-DSH-01
      x-guards: PASS
      x-rbac-role: user
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChatReadAckRequest"
  /api/dls/orders/{order_id}/eta:
    get:
      operationId: dls_orders_eta_get
      responses:
        "200":
          description: Get ETA independent of tracking UI.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Eta"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-USER
      summary: Get ETA independent of tracking UI.
      description: Get ETA independent of tracking UI.
      x-action-id: dls_orders_eta_get
      x-entity-code: SRV-DSH-01
      x-guards: PASS
      x-rbac-role: user
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
  /api/dls/orders/{order_id}/feedback:
    post:
      operationId: dls_feedback_create
      responses:
        "201":
          description: Submit feedback for order/store/captain.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Order"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-USER
      summary: Submit feedback for order/store/captain.
      description: Submit feedback for order/store/captain.
      x-action-id: dls_feedback_create
      x-entity-code: SRV-DSH-01
      x-guards: PASS
      x-rbac-role: user
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/FeedbackRequest"
  /api/dls/orders/{order_id}/notes:
    get:
      operationId: dls_order_notes_list
      responses:
        "200":
          description: List order notes with pagination.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NoteList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-USER
      summary: List order notes with pagination.
      description: List order notes with pagination.
      x-action-id: dls_order_notes_list
      x-entity-code: SRV-DSH-01
      x-guards: PASS
      x-rbac-role: user
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
    post:
      operationId: dls_order_notes_create
      responses:
        "201":
          description: Add short encrypted note to order timeline.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Note"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-USER
      summary: Add short encrypted note to order timeline.
      description: Add short encrypted note to order timeline.
      x-action-id: dls_order_notes_create
      x-entity-code: SRV-DSH-01
      x-guards: PASS
      x-rbac-role: user
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/NoteCreateRequest"
  /api/dls/orders/{order_id}/pickup/close:
    post:
      operationId: dls_pickup_close
      responses:
        "200":
          description: Close pickup using 6-digit code.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Order"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-USER
      summary: Close pickup using 6-digit code.
      description: Close pickup using 6-digit code.
      x-action-id: dls_pickup_close
      x-entity-code: SRV-DSH-01
      x-guards: PASS
      x-rbac-role: user
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PickupCloseRequest"
  /api/dls/orders/{order_id}/pod/verify:
    post:
      operationId: dls_pod_verify
      responses:
        "200":
          description: Verify proof of delivery for platform channel.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Order"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-USER
      summary: Verify proof of delivery for platform channel.
      description: Verify proof of delivery for platform channel.
      x-action-id: dls_pod_verify
      x-entity-code: SRV-DSH-01
      x-guards: PASS
      x-rbac-role: user
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PodVerifyRequest"
  /api/dls/orders/{order_id}/receipt:
    get:
      operationId: dls_receipt_get
      responses:
        "200":
          description: Get final receipt for the order.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Receipt"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-USER
      summary: Get final receipt for the order.
      description: Get final receipt for the order.
      x-action-id: dls_receipt_get
      x-entity-code: SRV-DSH-01
      x-guards: PASS
      x-rbac-role: user
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
  /api/dls/orders/{order_id}/reorder:
    post:
      operationId: dls_orders_reorder
      responses:
        "200":
          description: Reorder quickly from a previous order.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Order"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-USER
      summary: Reorder quickly from a previous order.
      description: Reorder quickly from a previous order.
      x-action-id: dls_orders_reorder
      x-entity-code: SRV-DSH-01
      x-guards: PASS
      x-rbac-role: user
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ReorderRequest"
  /api/dls/orders/{order_id}/timeline:
    get:
      operationId: dls_orders_timeline_get
      responses:
        "200":
          description: Get order timeline with timestamps and notes.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OrderTimeline"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-USER
      summary: Get order timeline with timestamps and notes.
      description: Get order timeline with timestamps and notes.
      x-action-id: dls_orders_timeline_get
      x-entity-code: SRV-DSH-01
      x-guards: PASS
      x-rbac-role: user
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
  /api/dls/orders/{order_id}/tracking:
    get:
      operationId: dls_tracking_get
      responses:
        "200":
          description: Get delivery tracking info.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TrackingInfo"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-USER
      summary: Get delivery tracking info.
      description: Get delivery tracking info.
      x-action-id: dls_tracking_get
      x-entity-code: SRV-DSH-01
      x-guards: PASS
      x-rbac-role: user
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
  /api/dls/partner/inbound/status:
    post:
      operationId: dls_partner_inbound_status_webhook
      responses:
        "200":
          description: Inbound status webhook from external partner middleware.
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security: []
      tags:
        - SYSTEM
      summary: Inbound status webhook from external partner middleware.
      description: Inbound status webhook from external partner middleware.
      x-action-id: inbound_status_webhook
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Webhook-HMAC,Anti-Replay≤300s,Allowlist,Problem,Audit-Immutable)
      x-rbac-role: system
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PartnerStatusWebhook"
  /api/dls/partner/orders:
    get:
      operationId: dls_partner_orders_list
      responses:
        "200":
          description: List partner orders with cursor/limit and filters.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OrderList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-PARTNER
      summary: List partner orders with cursor/limit and filters.
      description: List partner orders with cursor/limit and filters.
      x-action-id: list_orders
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Allowlist,Problem,Pagination)
      x-rbac-role: partner
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
  /api/dls/partner/orders/{order_id}:
    get:
      operationId: dls_partner_orders_get
      responses:
        "200":
          description: Get order details including items and timeline pointer.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Order"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-PARTNER
      summary: Get order details including items and timeline pointer.
      description: Get order details including items and timeline pointer.
      x-action-id: load_order
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Allowlist,Problem,PathParam)
      x-rbac-role: partner
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
  /api/dls/partner/orders/{order_id}/accept:
    post:
      operationId: dls_partner_orders_accept
      responses:
        "200":
          description: Accept order for fulfillment (partner or pickup modes).
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Order"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-PARTNER
      summary: Accept order for fulfillment (partner or pickup modes).
      description: Accept order for fulfillment (partner or pickup modes).
      x-action-id: accept_order
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Idem,Allowlist,Problem,PathParam)
      x-rbac-role: partner
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AcceptOrderRequest"
  /api/dls/partner/orders/{order_id}/chat/messages:
    get:
      operationId: dls_partner_chat_list
      responses:
        "200":
          description: List chat messages with pagination.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ChatList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-PARTNER
      summary: List chat messages with pagination.
      description: List chat messages with pagination.
      x-action-id: list_messages
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Allowlist,Problem,PathParam,Pagination,Masking)
      x-rbac-role: partner
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
    post:
      operationId: dls_partner_chat_send
      responses:
        "200":
          description: Send chat message with masking and AES-GCM field encryption.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ChatMessage"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-PARTNER
      summary: Send chat message with masking and AES-GCM field encryption.
      description: Send chat message with masking and AES-GCM field encryption.
      x-action-id: send_message
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Idem,Masking,Allowlist,Problem,PathParam)
      x-rbac-role: partner
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChatSendRequest"
  /api/dls/partner/orders/{order_id}/chat/read-ack:
    post:
      operationId: dls_partner_chat_read_ack
      responses:
        "200":
          description: Acknowledge chat read status.
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-PARTNER
      summary: Acknowledge chat read status.
      description: Acknowledge chat read status.
      x-action-id: ack_read
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Idem,Masking,Allowlist,Problem,PathParam)
      x-rbac-role: partner
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChatReadAckRequest"
  /api/dls/partner/orders/{order_id}/handoff:
    post:
      operationId: dls_partner_orders_handoff
      responses:
        "200":
          description: Confirm handoff to platform captain with PoD token scan if applicable.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Order"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-PARTNER
      summary: Confirm handoff to platform captain with PoD token scan if applicable.
      description: Confirm handoff to platform captain with PoD token scan if applicable.
      x-action-id: handoff_to_captain
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Idem,Allowlist,Problem,PathParam)
      x-rbac-role: partner
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/HandoffRequest"
  /api/dls/partner/orders/{order_id}/notes:
    get:
      operationId: dls_partner_order_notes_list
      responses:
        "200":
          description: List order notes with pagination.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NoteList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-PARTNER
      summary: List order notes with pagination.
      description: List order notes with pagination.
      x-action-id: list_notes
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Allowlist,Problem,PathParam,Pagination)
      x-rbac-role: partner
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
    post:
      operationId: dls_partner_order_notes_create
      responses:
        "201":
          description: Create encrypted short note visible to staff and user as policy allows.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Note"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-PARTNER
      summary: Create encrypted short note visible to staff and user as policy allows.
      description: Create encrypted short note visible to staff and user as policy allows.
      x-action-id: create_note
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Idem,Privacy-Export,Allowlist,Problem,PathParam)
      x-rbac-role: partner
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/NoteCreateRequest"
  /api/dls/partner/orders/{order_id}/pickup/close:
    post:
      operationId: dls_partner_pickup_close
      responses:
        "200":
          description: Close pickup by verifying 6-digit code from customer.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Order"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-PARTNER
      summary: Close pickup by verifying 6-digit code from customer.
      description: Close pickup by verifying 6-digit code from customer.
      x-action-id: submit_pickup_code
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Idem,Allowlist,Problem,PathParam)
      x-rbac-role: partner
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PickupCloseRequest"
  /api/dls/partner/orders/{order_id}/ready:
    post:
      operationId: dls_partner_orders_ready
      responses:
        "200":
          description: Mark order as ready for pickup/hand-off.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Order"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-PARTNER
      summary: Mark order as ready for pickup/hand-off.
      description: Mark order as ready for pickup/hand-off.
      x-action-id: mark_ready
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Idem,Allowlist,Problem,PathParam)
      x-rbac-role: partner
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MarkReadyRequest"
  /api/dls/partner/orders/{order_id}/receipt/issue:
    post:
      operationId: dls_partner_receipt_issue
      responses:
        "201":
          description: Issue final receipt payload after fulfillment review.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Receipt"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-PARTNER
      summary: Issue final receipt payload after fulfillment review.
      description: Issue final receipt payload after fulfillment review.
      x-action-id: issue_receipt
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Idem,Allowlist,Problem,PathParam)
      x-rbac-role: partner
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ReceiptIssueRequest"
  /api/dls/partner/orders/{order_id}/reject:
    post:
      operationId: dls_partner_orders_reject
      responses:
        "200":
          description: Reject order with a standard reason catalog.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Order"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-PARTNER
      summary: Reject order with a standard reason catalog.
      description: Reject order with a standard reason catalog.
      x-action-id: reject_order
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Idem,Allowlist,Problem,PathParam)
      x-rbac-role: partner
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RejectOrderRequest"
  /api/dls/partner/orders/{order_id}/timeline:
    get:
      operationId: dls_partner_orders_timeline_get
      responses:
        "200":
          description: View order timeline for auditing.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OrderTimeline"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-PARTNER
      summary: View order timeline for auditing.
      description: View order timeline for auditing.
      x-action-id: view_timeline
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Allowlist,Problem,PathParam)
      x-rbac-role: partner
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
  /api/dls/partners/intake:
    post:
      operationId: dls_partner_intake_start
      responses:
        "201":
          description: Start partner intake case and create a provisional partner record.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PartnerIntake"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-FIELD
      summary: Start partner intake case and create a provisional partner record.
      description: Start partner intake case and create a provisional partner record.
      x-action-id: start_intake
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Idem,Allowlist,Problem,Audit-Immutable)
      x-rbac-role: field_agent
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PartnerIntakeStart"
  /api/dls/partners/me/inventory/adjust:
    post:
      operationId: dls_partner_inventory_adjust
      responses:
        "200":
          description: Adjust stock/count for specific SKUs (optional profile).
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/InventoryAdjustResponse"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-PARTNER
      summary: Adjust stock/count for specific SKUs (optional profile).
      description: Adjust stock/count for specific SKUs (optional profile).
      x-action-id: adjust_inventory
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Idem,Allowlist,Problem)
      x-rbac-role: partner
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/InventoryAdjustRequest"
  /api/dls/partners/me/policies:
    get:
      operationId: dls_partner_policies_me_get
      responses:
        "200":
          description: Get active delivery modes/platform-partner-pickup policy toggles.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PartnerPolicies"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-PARTNER
      summary: Get active delivery modes/platform-partner-pickup policy toggles.
      description: Get active delivery modes/platform-partner-pickup policy toggles.
      x-action-id: load_partner_policies
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Allowlist,Problem)
      x-rbac-role: partner
    patch:
      operationId: dls_partner_policies_update
      responses:
        "200":
          description: Update partner policy toggles subject to admin approval gates.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PartnerPolicies"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-PARTNER
      summary: Update partner policy toggles subject to admin approval gates.
      description: Update partner policy toggles subject to admin approval gates.
      x-action-id: update_partner_policies
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Idem,Allowlist,Problem)
      x-rbac-role: partner
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PartnerPoliciesUpdate"
  /api/dls/partners/me/slots:
    get:
      operationId: dls_partner_slots_list
      responses:
        "200":
          description: List partner-defined pickup/delivery time slots for dark-store mode.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SlotList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-PARTNER
      summary: List partner-defined pickup/delivery time slots for dark-store mode.
      description: List partner-defined pickup/delivery time slots for dark-store mode.
      x-action-id: list_slots
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Allowlist,Problem,Pagination)
      x-rbac-role: partner
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
    post:
      operationId: dls_partner_slots_upsert
      responses:
        "200":
          description: Create or update a time slot definition.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Slot"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-PARTNER
      summary: Create or update a time slot definition.
      description: Create or update a time slot definition.
      x-action-id: upsert_slot
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Idem,Allowlist,Problem)
      x-rbac-role: partner
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SlotUpsertRequest"
  /api/dls/partners/me/slots/{slot_id}:
    delete:
      operationId: dls_partner_slots_delete
      responses:
        "204":
          description: Delete an existing time slot definition.
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-PARTNER
      summary: Delete an existing time slot definition.
      description: Delete an existing time slot definition.
      x-action-id: delete_slot
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Idem,Allowlist,Problem,PathParam)
      x-rbac-role: partner
      parameters:
        - name: slot_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
  /api/dls/partners/me/zones:
    get:
      operationId: dls_partner_zones_me_get
      responses:
        "200":
          description: Get coverage zones of the store.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PartnerZones"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-PARTNER
      summary: Get coverage zones of the store.
      description: Get coverage zones of the store.
      x-action-id: load_partner_zones
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Allowlist,Problem)
      x-rbac-role: partner
    patch:
      operationId: dls_partner_zones_update
      responses:
        "200":
          description: Update coverage zones subject to review/approval if flagged.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PartnerZones"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-PARTNER
      summary: Update coverage zones subject to review/approval if flagged.
      description: Update coverage zones subject to review/approval if flagged.
      x-action-id: update_partner_zones
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Idem,Allowlist,Problem)
      x-rbac-role: partner
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PartnerZonesUpdate"
  /api/dls/partners/pending:
    get:
      operationId: dls_partner_pending_list
      responses:
        "200":
          description: List pending partner intakes with pagination.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PartnerPendingList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-FIELD
      summary: List pending partner intakes with pagination.
      description: List pending partner intakes with pagination.
      x-action-id: list_pending
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Allowlist,Problem,Pagination)
      x-rbac-role: field_agent
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
  /api/dls/partners/{partner_id}:
    get:
      operationId: dls_partner_get
      responses:
        "200":
          description: Get partner details.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Partner"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-FIELD
      summary: Get partner details.
      description: Get partner details.
      x-action-id: get_partner
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Allowlist,Problem,PathParam)
      x-rbac-role: field_agent
      parameters:
        - name: partner_id
          in: path
          required: true
          schema:
            type: string
  /api/dls/partners/{partner_id}/approve:
    post:
      operationId: dls_partner_approve
      responses:
        "200":
          description: Approve partner; requires step-up; writes immutable audit.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Partner"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-FIELD
      summary: Approve partner; requires step-up; writes immutable audit.
      description: Approve partner; requires step-up; writes immutable audit.
      x-action-id: approve
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Idem,PathParam,Allowlist,Problem,Step-Up,Audit-Immutable)
      x-rbac-role: field_agent
      parameters:
        - name: partner_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ApproveRequest"
  /api/dls/partners/{partner_id}/bank:
    put:
      operationId: dls_partner_bank_set
      responses:
        "200":
          description: Set payout bank details with step-up verification.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BankInfo"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-FIELD
      summary: Set payout bank details with step-up verification.
      description: Set payout bank details with step-up verification.
      x-action-id: set_bank
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Idem,PathParam,Privacy-Export,Allowlist,Problem,Step-Up)
      x-rbac-role: field_agent
      parameters:
        - name: partner_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/BankInfo"
  /api/dls/partners/{partner_id}/documents:
    post:
      operationId: dls_partner_doc_upload
      responses:
        "200":
          description: Upload KYC/permit documents with AV scan and immutable audit trail.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Document"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-FIELD
      summary: Upload KYC/permit documents with AV scan and immutable audit trail.
      description: Upload KYC/permit documents with AV scan and immutable audit trail.
      x-action-id: upload_doc
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Idem,PathParam,Anti-Virus,Allowlist,Problem,Audit-Immutable)
      x-rbac-role: field_agent
      parameters:
        - name: partner_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/DocumentUpload"
  /api/dls/partners/{partner_id}/identity:
    post:
      operationId: dls_partner_identity_submit
      responses:
        "200":
          description: Submit legal name, CRN, tax id, owner info. Sensitive fields masked on export.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Partner"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-FIELD
      summary: Submit legal name, CRN, tax id, owner info. Sensitive fields masked
      description: Submit legal name, CRN, tax id, owner info. Sensitive fields masked on export.
      x-action-id: submit_identity
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Idem,PathParam,Privacy-Export,Allowlist,Problem)
      x-rbac-role: field_agent
      parameters:
        - name: partner_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PartnerIdentity"
  /api/dls/partners/{partner_id}/notifications:
    post:
      operationId: dls_partner_notifications_dispatch
      responses:
        "200":
          description: Dispatch SMS/WhatsApp notification to partner.
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security: []
      tags:
        - SYSTEM
        - APP-USER
      summary: Dispatch SMS/WhatsApp notification to partner.
      description: Dispatch SMS/WhatsApp notification to partner.
      x-action-id: dispatch_partner_notify
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Idem,RateLimit,Audit-Immutable,Allowlist,Problem,PathParam,Step-Up)
      x-rbac-role: system
      parameters:
        - name: partner_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PartnerNotifyRequest"
  /api/dls/partners/{partner_id}/policies:
    get:
      operationId: dls_partner_policies_get
      responses:
        "200":
          description: Get partner policies for platform/partner/pickup modes.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PartnerPolicies"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-USER
      summary: Get partner policies for platform/partner/pickup modes.
      description: Get partner policies for platform/partner/pickup modes.
      x-action-id: dls_partner_policies_get
      x-entity-code: SRV-DSH-01
      x-guards: PASS
      x-rbac-role: user
      parameters:
        - name: partner_id
          in: path
          required: true
          schema:
            type: string
  /api/dls/partners/{partner_id}/reject:
    post:
      operationId: dls_partner_reject
      responses:
        "200":
          description: Reject with reason; ticket remains for follow up.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ReviewTicket"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-FIELD
      summary: Reject with reason; ticket remains for follow up.
      description: Reject with reason; ticket remains for follow up.
      x-action-id: reject
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Idem,PathParam,Allowlist,Problem,Audit-Immutable)
      x-rbac-role: field_agent
      parameters:
        - name: partner_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RejectRequest"
  /api/dls/partners/{partner_id}/stores:
    post:
      operationId: dls_store_create
      responses:
        "201":
          description: Create a store under the partner.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Store"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-FIELD
      summary: Create a store under the partner.
      description: Create a store under the partner.
      x-action-id: create_store
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Idem,PathParam,Allowlist,Problem)
      x-rbac-role: field_agent
      parameters:
        - name: partner_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/StoreCreate"
  /api/dls/partners/{partner_id}/submit-review:
    post:
      operationId: dls_partner_submit_review
      responses:
        "200":
          description: Submit partner onboarding package for Ops review.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ReviewTicket"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-FIELD
      summary: Submit partner onboarding package for Ops review.
      description: Submit partner onboarding package for Ops review.
      x-action-id: submit_for_review
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Idem,PathParam,Allowlist,Problem,Audit-Immutable)
      x-rbac-role: field_agent
      parameters:
        - name: partner_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SubmitReview"
  /api/dls/partners/{partner_id}/users/invite:
    post:
      operationId: dls_partner_manager_invite
      responses:
        "200":
          description: Invite partner manager to Partner App.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserInviteResult"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-FIELD
      summary: Invite partner manager to Partner App.
      description: Invite partner manager to Partner App.
      x-action-id: invite_manager
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Idem,PathParam,Allowlist,Problem)
      x-rbac-role: field_agent
      parameters:
        - name: partner_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserInvite"
  /api/dls/partners/{partner_id}/zones:
    get:
      operationId: dls_partner_zones_get
      responses:
        "200":
          description: Get partner coverage zones.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PartnerZones"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-USER
      summary: Get partner coverage zones.
      description: Get partner coverage zones.
      x-action-id: dls_partner_zones_get
      x-entity-code: SRV-DSH-01
      x-guards: PASS
      x-rbac-role: user
      parameters:
        - name: partner_id
          in: path
          required: true
          schema:
            type: string
  /api/dls/quotes:
    post:
      operationId: dls_quotes_create
      responses:
        "201":
          description: Create preliminary quote or slot for Dark-Store.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/QuoteResponse"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-USER
      summary: Create preliminary quote or slot for Dark-Store.
      description: Create preliminary quote or slot for Dark-Store.
      x-action-id: dls_quotes_create
      x-entity-code: SRV-DSH-01
      x-guards: PASS
      x-rbac-role: user
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/QuoteRequest"
  /api/dls/slots:
    get:
      operationId: dls_slots_list
      responses:
        "200":
          description: List general Dark-Store delivery/pickup slots.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SlotList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-USER
      summary: List general Dark-Store delivery/pickup slots.
      description: List general Dark-Store delivery/pickup slots.
      x-action-id: dls_slots_list
      x-entity-code: SRV-DSH-01
      x-guards: PASS
      x-rbac-role: user
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
  /api/dls/stores/{store_id}:
    get:
      operationId: dls_store_get
      responses:
        "200":
          description: Get store details.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Store"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-FIELD
      summary: Get store details.
      description: Get store details.
      x-action-id: get_store
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Allowlist,Problem,PathParam)
      x-rbac-role: field_agent
      parameters:
        - name: store_id
          in: path
          required: true
          schema:
            type: string
    patch:
      operationId: dls_store_update
      responses:
        "200":
          description: Update store profile, hours, contacts.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Store"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-FIELD
      summary: Update store profile, hours, contacts.
      description: Update store profile, hours, contacts.
      x-action-id: update_store
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Idem,PathParam,Allowlist,Problem)
      x-rbac-role: field_agent
      parameters:
        - name: store_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/StoreUpdate"
  /api/dls/stores/{store_id}/commission:
    put:
      operationId: dls_store_commission_set
      responses:
        "200":
          description: Set sales commission policy; write to audit logs.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CommissionPolicy"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-FIELD
      summary: Set sales commission policy; write to audit logs.
      description: Set sales commission policy; write to audit logs.
      x-action-id: set_commission
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Idem,PathParam,Allowlist,Problem,Audit-Immutable)
      x-rbac-role: field_agent
      parameters:
        - name: store_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CommissionPolicy"
  /api/dls/stores/{store_id}/delivery-modes:
    put:
      operationId: dls_store_modes_set
      responses:
        "200":
          description: Enable platform/partner/pickup modes as agreed with the partner.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeliveryModes"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-FIELD
      summary: Enable platform/partner/pickup modes as agreed with the partner.
      description: Enable platform/partner/pickup modes as agreed with the partner.
      x-action-id: set_modes
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Idem,PathParam,Allowlist,Problem)
      x-rbac-role: field_agent
      parameters:
        - name: store_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/DeliveryModesSet"
  /api/dls/stores/{store_id}/zones:
    put:
      operationId: dls_store_zones_set
      responses:
        "200":
          description: Define delivery coverage zones for the store.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StoreZones"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-FIELD
      summary: Define delivery coverage zones for the store.
      description: Define delivery coverage zones for the store.
      x-action-id: set_zones
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Idem,PathParam,Allowlist,Problem)
      x-rbac-role: field_agent
      parameters:
        - name: store_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/StoreZonesSet"
  /api/fin/settlements/requests:
    post:
      operationId: partner_payout_request
      responses:
        "200":
          description: Create payout request (dual-sign later)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PayoutTicket"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-PARTNER
      summary: Create payout request (dual-sign later)
      description: Create payout request (dual-sign later)
      x-action-id: request_payout
      x-guards: PASS(Idem,Allowlist,Problem,Security,Step-Up,Audit-Immutable)
      x-rbac-role: partner_finance
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PayoutRequest"
  /api/fin/settlements/{settlement_id}:
    get:
      operationId: partner_settlement_get
      responses:
        "200":
          description: Settlement details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Settlement"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-PARTNER
      summary: Settlement details
      description: Settlement details
      x-action-id: load_settlement
      x-guards: PASS(Allowlist,Problem,PathParam,Security)
      x-rbac-role: partner_finance
      parameters:
        - name: settlement_id
          in: path
          required: true
          schema:
            type: string
  /api/fin/settlements:
    get:
      operationId: partner_settlements_list
      responses:
        "200":
          description: Settlement batches for store
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SettlementList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-PARTNER
      summary: Settlement batches for store
      description: Settlement batches for store
      x-action-id: list_settlements
      x-guards: PASS(Allowlist,Problem,Pagination,Security)
      x-rbac-role: partner_finance
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
        - name: store_id
          in: query
          required: true
          schema:
            type: string
  /api/fleet/captains/{captain_id}:
    get:
      operationId: fleet_captain_review_get
      responses:
        "200":
          description: Load captain profile for review
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CaptainProfile"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-FLEET
      summary: Load captain profile for review
      description: Load captain profile for review
      x-action-id: review_captain
      x-guards: PASS(Allowlist,Problem,PathParam)
      x-rbac-role: fleet_ops
      parameters:
        - name: captain_id
          in: path
          required: true
          schema:
            type: string
  /api/fleet/captains/{captain_id}/approve:
    post:
      operationId: fleet_captain_approve
      responses:
        "200":
          description: Approve captain after KYC and vehicle check
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CaptainProfile"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-FLEET
      summary: Approve captain after KYC and vehicle check
      description: Approve captain after KYC and vehicle check
      x-action-id: approve_captain
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Step-Up)
      x-rbac-role: fleet_ops
      parameters:
        - name: captain_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CaptainApprovalRequest"
  /api/fleet/captains/{captain_id}/force-offline:
    post:
      operationId: fleet_captain_force_offline
      responses:
        "200":
          description: Force captain offline with reason and TTL
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CaptainStatus"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-FLEET
      summary: Force captain offline with reason and TTL
      description: Force captain offline with reason and TTL
      x-action-id: force_offline
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Step-Up)
      x-rbac-role: fleet_ops
      parameters:
        - name: captain_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ForceOfflineRequest"
  /api/fleet/captains/{captain_id}/reject:
    post:
      operationId: fleet_captain_reject
      responses:
        "200":
          description: Reject captain with reason
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CaptainProfile"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-FLEET
      summary: Reject captain with reason
      description: Reject captain with reason
      x-action-id: reject_captain
      x-guards: PASS(Idem,Allowlist,Problem,PathParam)
      x-rbac-role: fleet_ops
      parameters:
        - name: captain_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CaptainRejectionRequest"
  /api/fleet/dispatch/orders/{order_id}/assign:
    post:
      operationId: fleet_assign_order
      responses:
        "200":
          description: Assign order to captain manually
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Assignment"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-FLEET
      summary: Assign order to captain manually
      description: Assign order to captain manually
      x-action-id: assign_order
      x-guards: PASS(Idem,Allowlist,Problem,PathParam)
      x-rbac-role: fleet_ops
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AssignOrderRequest"
  /api/fleet/dispatch/orders/{order_id}/reassign:
    post:
      operationId: fleet_reassign_order
      responses:
        "200":
          description: Reassign order to another captain
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Assignment"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-FLEET
      summary: Reassign order to another captain
      description: Reassign order to another captain
      x-action-id: reassign_order
      x-guards: PASS(Idem,Allowlist,Problem,PathParam)
      x-rbac-role: fleet_ops
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ReassignOrderRequest"
  /api/fleet/dispatch/unassigned:
    get:
      operationId: fleet_unassigned_orders_list
      responses:
        "200":
          description: List unassigned delivery orders
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DispatchOrderList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-FLEET
      summary: List unassigned delivery orders
      description: List unassigned delivery orders
      x-action-id: list_unassigned
      x-guards: PASS(Allowlist,Problem,Pagination)
      x-rbac-role: fleet_ops
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
  /api/fleet/inbound/location:
    post:
      operationId: fleet_inbound_location_webhook
      responses:
        "200":
          description: Inbound location webhook with HMAC
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security: []
      tags:
        - DASH-FLEET
      summary: Inbound location webhook with HMAC
      description: Inbound location webhook with HMAC
      x-action-id: inbound_location_webhook
      x-guards: PASS(Webhook-HMAC,Anti-Replay?300s,Allowlist,Problem)
      x-rbac-role: system
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LocationWebhook"
  /api/fleet/incidents:
    post:
      operationId: fleet_incident_create
      responses:
        "201":
          description: Log operational or safety incident
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Incident"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-FLEET
      summary: Log operational or safety incident
      description: Log operational or safety incident
      x-action-id: create_incident
      x-guards: PASS(Idem,Allowlist,Problem,Audit-Immutable)
      x-rbac-role: fleet_ops
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/IncidentCreateRequest"
    get:
      operationId: fleet_incidents_list
      responses:
        "200":
          description: List incidents with filters
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IncidentList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-FLEET
      summary: List incidents with filters
      description: List incidents with filters
      x-action-id: list_incidents
      x-guards: PASS(Allowlist,Problem,Pagination)
      x-rbac-role: fleet_ops
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
        - name: status
          in: query
          required: false
          schema:
            type: string
  /api/fleet/live/locations:
    get:
      operationId: fleet_live_locations_list
      responses:
        "200":
          description: Query live captain locations
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CaptainLocationList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-FLEET
      summary: Query live captain locations
      description: Query live captain locations
      x-action-id: list_locations
      x-guards: PASS(Allowlist,Problem)
      x-rbac-role: fleet_ops
      parameters:
        - name: city
          in: query
          required: false
          schema:
            type: string
        - name: radius_km
          in: query
          required: false
          schema:
            type: number
            minimum: 0
  /api/fleet/shifts/{shift_id}/assign:
    post:
      operationId: fleet_shift_assign
      responses:
        "200":
          description: Assign captain(s) to shift
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Shift"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-FLEET
      summary: Assign captain(s) to shift
      description: Assign captain(s) to shift
      x-action-id: assign_shift
      x-guards: PASS(Idem,Allowlist,Problem,PathParam)
      x-rbac-role: fleet_ops
      parameters:
        - name: shift_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ShiftAssignRequest"
  /api/fleet/shifts:
    get:
      operationId: fleet_shifts_list
      responses:
        "200":
          description: List active and planned shifts
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ShiftList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-FLEET
      summary: List active and planned shifts
      description: List active and planned shifts
      x-action-id: list_shifts
      x-guards: PASS(Allowlist,Problem,Pagination)
      x-rbac-role: fleet_ops
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
  /api/hr/attendance/{employee_id}/adjust:
    post:
      operationId: hr_attendance_adjust
      responses:
        "200":
          description: Adjust attendance record with audit.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AttendanceRecord"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-HR
      summary: Adjust attendance record with audit.
      description: Adjust attendance record with audit.
      x-action-id: adjust_attendance
      x-entity-code: DASH-HR
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Audit-Immutable)
      x-rbac-role: hr_manager
      parameters:
        - name: employee_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AttendanceAdjustRequest"
  /api/hr/attendance:
    get:
      operationId: hr_attendance_range_get
      responses:
        "200":
          description: Attendance window summary.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AttendanceRange"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-HR
      summary: Attendance window summary.
      description: Attendance window summary.
      x-action-id: load_attendance
      x-entity-code: DASH-HR
      x-guards: PASS(Allowlist,Problem)
      x-rbac-role: hr_manager
      parameters:
        - name: from
          in: query
          required: true
          schema:
            type: string
        - name: to
          in: query
          required: true
          schema:
            type: string
  /api/hr/benefits:
    get:
      operationId: hr_benefits_list
      responses:
        "200":
          description: List benefits.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BenefitList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-HR
      summary: List benefits.
      description: List benefits.
      x-action-id: list_benefits
      x-entity-code: DASH-HR
      x-guards: PASS(Allowlist,Problem,Pagination)
      x-rbac-role: hr_manager
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
  /api/hr/benefits/{benefit_id}:
    patch:
      operationId: hr_benefit_update
      responses:
        "200":
          description: Update benefit.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Benefit"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-HR
      summary: Update benefit.
      description: Update benefit.
      x-action-id: update_benefit
      x-entity-code: DASH-HR
      x-guards: PASS(Idem,Allowlist,Problem,PathParam)
      x-rbac-role: hr_manager
      parameters:
        - name: benefit_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/BenefitUpdateRequest"
  /api/hr/contracts:
    get:
      operationId: hr_contracts_list
      responses:
        "200":
          description: List contracts.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ContractList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-HR
      summary: List contracts.
      description: List contracts.
      x-action-id: list_contracts
      x-entity-code: DASH-HR
      x-guards: PASS(Allowlist,Problem,Pagination)
      x-rbac-role: hr_manager
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
    post:
      operationId: hr_contract_create
      responses:
        "201":
          description: Create new contract.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Contract"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-HR
      summary: Create new contract.
      description: Create new contract.
      x-action-id: create_contract
      x-entity-code: DASH-HR
      x-guards: PASS(Idem,Allowlist,Problem)
      x-rbac-role: hr_manager
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ContractCreateRequest"
  /api/hr/contracts/{contract_id}:
    patch:
      operationId: hr_contract_update
      responses:
        "200":
          description: Update contract.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Contract"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-HR
      summary: Update contract.
      description: Update contract.
      x-action-id: update_contract
      x-entity-code: DASH-HR
      x-guards: PASS(Idem,Allowlist,Problem,PathParam)
      x-rbac-role: hr_manager
      parameters:
        - name: contract_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ContractUpdateRequest"
  /api/hr/employees:
    get:
      operationId: hr_employees_list
      responses:
        "200":
          description: List employees with pagination.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EmployeeList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-HR
      summary: List employees with pagination.
      description: List employees with pagination.
      x-action-id: list_employees
      x-entity-code: DASH-HR
      x-guards: PASS(Allowlist,Problem,Pagination)
      x-rbac-role: hr_manager
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
    post:
      operationId: hr_employee_create
      responses:
        "201":
          description: Create employee.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Employee"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-HR
      summary: Create employee.
      description: Create employee.
      x-action-id: create_employee
      x-entity-code: DASH-HR
      x-guards: PASS(Idem,Allowlist,Problem)
      x-rbac-role: hr_manager
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/EmployeeCreateRequest"
  /api/hr/employees/{employee_id}:
    get:
      operationId: hr_employee_get
      responses:
        "200":
          description: Get employee profile.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Employee"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-HR
      summary: Get employee profile.
      description: Get employee profile.
      x-action-id: load_employee
      x-entity-code: DASH-HR
      x-guards: PASS(Allowlist,Problem,PathParam)
      x-rbac-role: hr_manager
      parameters:
        - name: employee_id
          in: path
          required: true
          schema:
            type: string
    patch:
      operationId: hr_employee_update
      responses:
        "200":
          description: Update employee.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Employee"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-HR
      summary: Update employee.
      description: Update employee.
      x-action-id: update_employee
      x-entity-code: DASH-HR
      x-guards: PASS(Idem,Allowlist,Problem,PathParam)
      x-rbac-role: hr_manager
      parameters:
        - name: employee_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/EmployeeUpdateRequest"
  /api/hr/employees/{employee_id}/deactivate:
    post:
      operationId: hr_employee_deactivate
      responses:
        "200":
          description: Deactivate employee (requires Step-Up).
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Employee"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-HR
      summary: Deactivate employee (requires Step-Up).
      description: Deactivate employee (requires Step-Up).
      x-action-id: deactivate_employee
      x-entity-code: DASH-HR
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Step-Up)
      x-rbac-role: hr_manager
      parameters:
        - name: employee_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/EmployeeDeactivateRequest"
  /api/hr/holidays:
    get:
      operationId: hr_holidays_list
      responses:
        "200":
          description: List holidays calendar.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HolidayList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-HR
      summary: List holidays calendar.
      description: List holidays calendar.
      x-action-id: list_holidays
      x-entity-code: DASH-HR
      x-guards: PASS(Allowlist,Problem)
      x-rbac-role: hr_manager
    post:
      operationId: hr_holiday_create
      responses:
        "201":
          description: Create holiday.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Holiday"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-HR
      summary: Create holiday.
      description: Create holiday.
      x-action-id: create_holiday
      x-entity-code: DASH-HR
      x-guards: PASS(Idem,Allowlist,Problem)
      x-rbac-role: hr_manager
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/HolidayCreateRequest"
  /api/hr/inbound/payroll-status:
    post:
      operationId: hr_payroll_status_webhook
      responses:
        "200":
          description: Inbound payroll processing status.
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security: []
      tags:
        - SYSTEM
      summary: Inbound payroll processing status.
      description: Inbound payroll processing status.
      x-action-id: payroll_status_webhook
      x-entity-code: DASH-HR
      x-guards: PASS(Webhook-HMAC,Anti-Replay≤300s,Allowlist,Problem,Audit-Immutable)
      x-rbac-role: system
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PayrollStatusWebhook"
  /api/hr/incentives/configure:
    post:
      operationId: hr_incentives_configure
      responses:
        "200":
          description: Configure incentive pool and rules.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IncentivesConfig"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-HR
      summary: Configure incentive pool and rules.
      description: Configure incentive pool and rules.
      x-action-id: configure_incentives
      x-entity-code: DASH-HR
      x-guards: PASS(Idem,Allowlist,Problem)
      x-rbac-role: hr_payroll_manager
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/IncentivesConfigRequest"
  /api/hr/leaves:
    get:
      operationId: hr_leaves_list
      responses:
        "200":
          description: List leave requests.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LeaveList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-HR
      summary: List leave requests.
      description: List leave requests.
      x-action-id: list_leaves
      x-entity-code: DASH-HR
      x-guards: PASS(Allowlist,Problem,Pagination)
      x-rbac-role: hr_manager
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
  /api/hr/leaves/{leave_id}/approve:
    post:
      operationId: hr_leave_approve
      responses:
        "200":
          description: Approve leave.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Leave"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-HR
      summary: Approve leave.
      description: Approve leave.
      x-action-id: approve_leave
      x-entity-code: DASH-HR
      x-guards: PASS(Idem,Allowlist,Problem,PathParam)
      x-rbac-role: hr_manager
      parameters:
        - name: leave_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LeaveDecisionRequest"
  /api/hr/leaves/{leave_id}/reject:
    post:
      operationId: hr_leave_reject
      responses:
        "200":
          description: Reject leave.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Leave"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-HR
      summary: Reject leave.
      description: Reject leave.
      x-action-id: reject_leave
      x-entity-code: DASH-HR
      x-guards: PASS(Idem,Allowlist,Problem,PathParam)
      x-rbac-role: hr_manager
      parameters:
        - name: leave_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LeaveDecisionRequest"
  /api/hr/metrics:
    get:
      operationId: hr_metrics_get
      responses:
        "200":
          description: Load HR KPIs summary.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HrMetrics"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-HR
      summary: Load HR KPIs summary.
      description: Load HR KPIs summary.
      x-action-id: load_metrics
      x-entity-code: DASH-HR
      x-guards: PASS(Allowlist,Problem)
      x-rbac-role: hr_manager
  /api/hr/payroll/build:
    post:
      operationId: hr_payroll_build
      responses:
        "201":
          description: Build payroll draft for a period.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PayrollRun"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-HR
      summary: Build payroll draft for a period.
      description: Build payroll draft for a period.
      x-action-id: build_payroll
      x-entity-code: DASH-HR
      x-guards: PASS(Idem,Allowlist,Problem,Step-Up)
      x-rbac-role: hr_payroll_manager
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PayrollBuildRequest"
  /api/hr/payroll/runs:
    get:
      operationId: hr_payroll_runs_list
      responses:
        "200":
          description: List payroll runs.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PayrollRunList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-HR
      summary: List payroll runs.
      description: List payroll runs.
      x-action-id: list_runs
      x-entity-code: DASH-HR
      x-guards: PASS(Allowlist,Problem,Pagination)
      x-rbac-role: hr_payroll_manager
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
  /api/hr/payroll/runs/{run_id}/approve:
    post:
      operationId: hr_payroll_approve
      responses:
        "200":
          description: Approve payroll run.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PayrollRun"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-HR
      summary: Approve payroll run.
      description: Approve payroll run.
      x-action-id: approve_payroll
      x-entity-code: DASH-HR
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Step-Up)
      x-rbac-role: hr_payroll_manager
      parameters:
        - name: run_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PayrollApproveRequest"
  /api/hr/payroll/runs/{run_id}/export:
    post:
      operationId: hr_payroll_export
      responses:
        "201":
          description: Export masked payroll for bank file.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ExportReceipt"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-HR
      summary: Export masked payroll for bank file.
      description: Export masked payroll for bank file.
      x-action-id: export_payroll
      x-entity-code: DASH-HR
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Privacy-Export)
      x-rbac-role: hr_payroll_manager
      parameters:
        - name: run_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PayrollExportRequest"
  /api/hr/payroll/runs/{run_id}/lock:
    post:
      operationId: hr_payroll_lock
      responses:
        "200":
          description: Lock payroll run (no further edits).
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PayrollRun"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-HR
      summary: Lock payroll run (no further edits).
      description: Lock payroll run (no further edits).
      x-action-id: lock_payroll
      x-entity-code: DASH-HR
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Step-Up)
      x-rbac-role: hr_payroll_manager
      parameters:
        - name: run_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PayrollLockRequest"
  /api/hr/payroll/runs/{run_id}/payouts/queue:
    post:
      operationId: hr_payroll_payouts_queue
      responses:
        "201":
          description: Queue bank payouts batch with dual-sign policy.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PayoutsBatch"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-HR
      summary: Queue bank payouts batch with dual-sign policy.
      description: Queue bank payouts batch with dual-sign policy.
      x-action-id: queue_payouts
      x-entity-code: DASH-HR
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Audit-Immutable,Step-Up)
      x-rbac-role: finance
      parameters:
        - name: run_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PayoutsQueueRequest"
  /api/hr/shifts:
    get:
      operationId: hr_shifts_list
      responses:
        "200":
          description: List shifts.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ShiftList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-HR
      summary: List shifts.
      description: List shifts.
      x-action-id: list_shifts
      x-entity-code: DASH-HR
      x-guards: PASS(Allowlist,Problem,Pagination)
      x-rbac-role: hr_manager
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
  /api/hr/shifts/{shift_id}/assign:
    post:
      operationId: hr_shift_assign
      responses:
        "200":
          description: Assign shift to employee.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ShiftAssignment"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-HR
      summary: Assign shift to employee.
      description: Assign shift to employee.
      x-action-id: assign_shift
      x-entity-code: DASH-HR
      x-guards: PASS(Idem,Allowlist,Problem,PathParam)
      x-rbac-role: hr_manager
      parameters:
        - name: shift_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ShiftAssignRequest"
  /api/hr/timesheets:
    get:
      operationId: hr_timesheets_list
      responses:
        "200":
          description: List timesheets.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TimesheetList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-HR
      summary: List timesheets.
      description: List timesheets.
      x-action-id: list_timesheets
      x-entity-code: DASH-HR
      x-guards: PASS(Allowlist,Problem,Pagination)
      x-rbac-role: hr_manager
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
  /api/hr/timesheets/{timesheet_id}/approve:
    post:
      operationId: hr_timesheet_approve
      responses:
        "200":
          description: Approve timesheet.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Timesheet"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-HR
      summary: Approve timesheet.
      description: Approve timesheet.
      x-action-id: approve_timesheet
      x-entity-code: DASH-HR
      x-guards: PASS(Idem,Allowlist,Problem,PathParam)
      x-rbac-role: hr_manager
      parameters:
        - name: timesheet_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TimesheetDecisionRequest"
  /api/mkt/campaigns:
    get:
      operationId: mktCampaignsList
      description: Lists outbound marketing campaigns filtered by pagination parameters.
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CampaignList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-MKT
      x-action-id: list_campaigns
      x-entity-code: DASH-MKT
      x-guards: PASS(Allowlist,Problem,Pagination)
      x-rbac-role: marketing_analyst
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
    post:
      operationId: mktCampaignsCreate
      description: Creates a new outbound marketing campaign with audience and scheduling details.
      responses:
        "201":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Campaign"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-MKT
      x-action-id: create_campaign
      x-entity-code: DASH-MKT
      x-guards: PASS(Idem,Allowlist,Problem,Security)
      x-rbac-role: marketing_owner
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CampaignCreateRequest"
  /api/mkt/campaigns/{campaign_id}:
    get:
      operationId: mktCampaignsGet
      description: Retrieves the full definition and current status of a marketing campaign.
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Campaign"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-MKT
      x-action-id: get_campaign
      x-entity-code: DASH-MKT
      x-guards: PASS(Allowlist,Problem,PathParam)
      x-rbac-role: marketing_analyst
      parameters:
        - name: campaign_id
          in: path
          required: true
          schema:
            type: string
    patch:
      operationId: mktCampaignsUpdate
      description: Updates targeting or content for an existing marketing campaign.
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Campaign"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-MKT
      x-action-id: update_campaign
      x-entity-code: DASH-MKT
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Security)
      x-rbac-role: marketing_owner
      parameters:
        - name: campaign_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CampaignUpdateRequest"
  /api/mkt/campaigns/{campaign_id}/send:
    post:
      operationId: mktCampaignsSend
      description: Triggers immediate delivery of a campaign to its approved audience.
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Campaign"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-MKT
      x-action-id: send_campaign
      x-entity-code: DASH-MKT
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Step-Up,Audit-Immutable)
      x-rbac-role: marketing_owner+stepup
      parameters:
        - name: campaign_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CampaignSendRequest"
  /api/mkt/channels/sms/test:
    post:
      operationId: mktChannelsSmsTest
      description: Sends a single SMS test message to validate channel configuration and templates.
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ChannelTestResult"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-MKT
      x-action-id: sms_test
      x-entity-code: DASH-MKT
      x-guards: PASS(Idem,Allowlist,Problem,Security)
      x-rbac-role: marketing_owner
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SmsTestRequest"
  /api/mkt/channels/whatsapp/test:
    post:
      operationId: mktChannelsWaTest
      description: Triggers a WhatsApp test to ensure credentials and templates are approved.
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ChannelTestResult"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-MKT
      x-action-id: wa_test
      x-entity-code: DASH-MKT
      x-guards: PASS(Idem,Allowlist,Problem,Security)
      x-rbac-role: marketing_owner
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/WhatsAppTestRequest"
  /api/mkt/consent/opt-in:
    post:
      operationId: mktConsentOptIn
      description: Records a customer opt-in event and updates consent state.
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsentState"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-MKT
      x-action-id: opt_in
      x-entity-code: DASH-MKT
      x-guards: PASS(Idem,Allowlist,Problem,RateLimit)
      x-rbac-role: public
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/OptInRequest"
  /api/mkt/consent/opt-out:
    post:
      operationId: mktConsentOptOut
      description: Registers a marketing opt-out request and suppresses future outreach.
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsentState"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-MKT
      x-action-id: opt_out
      x-entity-code: DASH-MKT
      x-guards: PASS(Idem,Allowlist,Problem,RateLimit)
      x-rbac-role: public
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/OptOutRequest"
  /api/mkt/subscribers:
    get:
      operationId: mktSubscribersList
      description: Lists marketing subscribers and segmentation attributes with pagination.
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SubscriberList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-MKT
      x-action-id: list_subscribers
      x-entity-code: DASH-MKT
      x-guards: PASS(Allowlist,Problem,Pagination,Privacy-Export)
      x-rbac-role: marketing_analyst
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
  /api/mkt/subscribers/import:
    post:
      operationId: mktSubscribersImport
      description: Imports or updates subscribers in bulk and queues downstream processing.
      responses:
        "201":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ImportResult"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-MKT
      x-action-id: import_subscribers
      x-entity-code: DASH-MKT
      x-guards: PASS(Idem,Allowlist,Problem,Privacy-Export,No-Secrets)
      x-rbac-role: marketing_owner
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SubscriberImportRequest"
  /api/mkt/webhooks/inbound/sms:
    post:
      operationId: mktInboundSmsWebhook
      description: Ingests inbound SMS delivery receipts or replies from the telecom provider.
      responses:
        "200":
          description: Success
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security: []
      tags:
        - DASH-MKT
      x-action-id: sms_inbound
      x-entity-code: DASH-MKT
      x-guards: PASS(Webhook-HMAC,Anti-Replay≤300s,Audit-Immutable)
      x-rbac-role: system
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SmsInboundWebhook"
  /api/mkt/webhooks/inbound/whatsapp:
    post:
      operationId: mktInboundWaWebhook
      description: Processes inbound WhatsApp delivery callbacks or customer responses.
      responses:
        "200":
          description: Success
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security: []
      tags:
        - DASH-MKT
      x-action-id: wa_inbound
      x-entity-code: DASH-MKT
      x-guards: PASS(Webhook-HMAC,Anti-Replay≤300s,Audit-Immutable)
      x-rbac-role: system
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/WhatsAppInboundWebhook"
  /api/ops/dls/audit/logs:
    get:
      operationId: ops_dls_audit_logs_list
      description: Lists delivery operations audit logs filtered via cursor pagination.
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuditLogList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-OPS
      x-action-id: list_audit_logs
      x-guards: PASS(Allowlist,Problem,Pagination,Audit-Immutable)
      x-rbac-role: ops_audit
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
  /api/ops/dls/disputes:
    get:
      operationId: ops_dls_disputes_list
      description: Retrieves active delivery disputes requiring operations review.
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DisputeList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-OPS
      x-action-id: list_disputes
      x-guards: PASS(Allowlist,Problem,Pagination)
      x-rbac-role: ops_support
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
  /api/ops/dls/inbound/messages:
    post:
      operationId: ops_dls_inbound_messages_webhook
      description: Accepts inbound message webhooks from delivery partners with HMAC validation.
      responses:
        "200":
          description: Success
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security: []
      tags:
        - DASH-OPS
      x-action-id: ingest_inbound
      x-guards: PASS(Webhook-HMAC,Anti-Replay≤300s,Allowlist,Problem,Audit-Immutable)
      x-rbac-role: system
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/InboundMessageWebhook"
  /api/ops/dls/orders:
    get:
      operationId: ops_dls_orders_list
      description: Lists live delivery orders with dispatch status for operations staff.
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OrderList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-OPS
      x-action-id: list_live_orders
      x-guards: PASS(Allowlist,Problem,Pagination)
      x-rbac-role: ops_dispatch
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
  /api/ops/dls/orders/{order_id}:
    get:
      operationId: ops_dls_orders_get
      description: Retrieves detailed information for a specific delivery order.
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Order"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-OPS
      x-action-id: load_order
      x-guards: PASS(Allowlist,Problem,PathParam)
      x-rbac-role: ops_dispatch
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
  /api/ops/dls/orders/{order_id}/dispatch/assign:
    post:
      operationId: ops_dls_dispatch_assign
      description: Assigns or reassigns a delivery captain to the targeted order.
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Order"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-OPS
      x-action-id: assign_captain
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Step-Up)
      x-rbac-role: ops_dispatch
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AssignCaptainRequest"
  /api/ops/dls/partners/onboarding:
    get:
      operationId: ops_dls_partners_onboarding_list
      description: Lists partner onboarding cases pending action by delivery operations.
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PartnerOnboardingList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-OPS
      x-action-id: list_partner_onboarding
      x-guards: PASS(Allowlist,Problem,Pagination,Audit-Immutable)
      x-rbac-role: ops_partner_ops
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
  /api/ops/dls/partners/{partner_id}/notifications:
    post:
      operationId: ops_dls_partner_notifications_dispatch
      description: Sends an operational notification payload to the specified partner.
      responses:
        "200":
          description: Success
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-OPS
      x-action-id: dispatch_partner_notify
      x-guards: PASS(Idem,RateLimit,Audit-Immutable,Allowlist,Problem,PathParam,Step-Up)
      x-rbac-role: ops_partner_ops
      parameters:
        - name: partner_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PartnerNotifyRequest"
  /api/ops/dls/sla/breaches:
    get:
      operationId: ops_dls_sla_breaches_list
      description: Lists recent SLA breach events for monitoring and remediation.
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SLABreachList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-OPS
      x-action-id: list_sla_breaches
      x-guards: PASS(Allowlist,Problem,Pagination)
      x-rbac-role: ops_dispatch
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
  /api/ops/dls/slots/{slot_id}:
    patch:
      operationId: ops_dls_slots_update
      description: Updates the configuration of an existing delivery slot, such as capacity or timing.
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Slot"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-OPS
      x-action-id: update_slot
      x-guards: PASS(Idem,Allowlist,Problem,PathParam)
      x-rbac-role: ops_darkstore
      parameters:
        - name: slot_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SlotUpdateRequest"
  /api/partner/inbound/messages:
    post:
      operationId: partner_inbound_messages_webhook
      responses:
        "200":
          description: Inbound channel webhook with HMAC
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security: []
      tags:
        - DASH-PARTNER
      summary: Inbound channel webhook with HMAC
      description: Inbound channel webhook with HMAC
      x-action-id: inbound_msg_webhook
      x-guards: PASS(Webhook-HMAC,Anti-Replay?300s,Allowlist,Problem,Audit-Immutable)
      x-rbac-role: system
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/InboundMessageWebhook"
  /api/partner/media/signed-url:
    post:
      operationId: partner_media_signed_url_create
      responses:
        "201":
          description: Create signed URL for media upload
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SignedUrlResponse"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-PARTNER
      summary: Create signed URL for media upload
      description: Create signed URL for media upload
      x-action-id: create_signed_url
      x-guards: PASS(Idem,Allowlist,Problem,Security)
      x-rbac-role: partner_catalog
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SignedUrlRequest"
  /api/partner/overview:
    get:
      operationId: partner_overview_get
      responses:
        "200":
          description: Overview KPIs and alerts
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Overview"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-PARTNER
      summary: Overview KPIs and alerts
      description: Overview KPIs and alerts
      x-action-id: load_overview
      x-guards: PASS(Allowlist,Problem,Security)
      x-rbac-role: partner_owner
  /api/partner/stores:
    get:
      operationId: partner_stores_list
      responses:
        "200":
          description: List partner stores with pagination
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StoreList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-PARTNER
      summary: List partner stores with pagination
      description: List partner stores with pagination
      x-action-id: list_stores
      x-guards: PASS(Allowlist,Problem,Pagination,Security)
      x-rbac-role: partner_owner
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
  /api/partner/stores/{store_id}:
    get:
      operationId: partner_store_get
      responses:
        "200":
          description: Get store details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Store"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-PARTNER
      summary: Get store details
      description: Get store details
      x-action-id: load_store
      x-guards: PASS(Allowlist,Problem,PathParam,Security)
      x-rbac-role: partner_owner
      parameters:
        - name: store_id
          in: path
          required: true
          schema:
            type: string
    patch:
      operationId: partner_store_update
      responses:
        "200":
          description: Update store profile and settings
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Store"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-PARTNER
      summary: Update store profile and settings
      description: Update store profile and settings
      x-action-id: update_store
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Security)
      x-rbac-role: partner_owner
      parameters:
        - name: store_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/StoreUpdate"
  /api/partner/stores/{store_id}/availability:
    post:
      operationId: partner_store_availability_toggle
      responses:
        "200":
          description: Open/close store
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Store"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-PARTNER
      summary: Open/close store
      description: Open/close store
      x-action-id: toggle_availability
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Security)
      x-rbac-role: partner_owner
      parameters:
        - name: store_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AvailabilityToggle"
  /api/partner/stores/{store_id}/chat/threads:
    get:
      operationId: partner_chat_threads_list
      responses:
        "200":
          description: List chat threads (masked)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ChatThreadList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-PARTNER
      summary: List chat threads (masked)
      description: List chat threads (masked)
      x-action-id: list_threads
      x-guards: PASS(Allowlist,Problem,PathParam,Pagination,Masking,Security)
      x-rbac-role: partner_support
      parameters:
        - name: store_id
          in: path
          required: true
          schema:
            type: string
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
  /api/partner/stores/{store_id}/chat/threads/{thread_id}/messages:
    post:
      operationId: partner_chat_messages_send
      responses:
        "200":
          description: Send chat message (masked)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ChatMessage"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-PARTNER
      summary: Send chat message (masked)
      description: Send chat message (masked)
      x-action-id: send_message
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Masking,Security)
      x-rbac-role: partner_support
      parameters:
        - name: store_id
          in: path
          required: true
          schema:
            type: string
        - name: thread_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChatSend"
  /api/partner/stores/{store_id}/coupons:
    get:
      operationId: partner_coupons_list
      responses:
        "200":
          description: List coupons
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CouponList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-PARTNER
      summary: List coupons
      description: List coupons
      x-action-id: list_coupons
      x-guards: PASS(Allowlist,Problem,PathParam,Pagination,Security)
      x-rbac-role: partner_marketing
      parameters:
        - name: store_id
          in: path
          required: true
          schema:
            type: string
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
    post:
      operationId: partner_coupons_create
      responses:
        "201":
          description: Create coupon
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Coupon"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-PARTNER
      summary: Create coupon
      description: Create coupon
      x-action-id: create_coupon
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Security)
      x-rbac-role: partner_marketing
      parameters:
        - name: store_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CouponCreate"
  /api/partner/stores/{store_id}/delivery-modes:
    put:
      operationId: partner_delivery_modes_set
      responses:
        "200":
          description: Configure platform/partner/pickup modes
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeliveryModes"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-PARTNER
      summary: Configure platform/partner/pickup modes
      description: Configure platform/partner/pickup modes
      x-action-id: set_modes
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Security)
      x-rbac-role: partner_owner
      parameters:
        - name: store_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/DeliveryModesSet"
  /api/partner/stores/{store_id}/hours:
    put:
      operationId: partner_store_hours_update
      responses:
        "200":
          description: Set business hours
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StoreHours"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-PARTNER
      summary: Set business hours
      description: Set business hours
      x-action-id: update_hours
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Security)
      x-rbac-role: partner_owner
      parameters:
        - name: store_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/StoreHoursUpdate"
  /api/partner/stores/{store_id}/inventory/bulk:
    post:
      operationId: partner_inventory_bulk_update
      responses:
        "200":
          description: Bulk inventory update
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/InventoryBulkResult"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-PARTNER
      summary: Bulk inventory update
      description: Bulk inventory update
      x-action-id: bulk_inventory
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Security)
      x-rbac-role: partner_catalog
      parameters:
        - name: store_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/InventoryBulk"
  /api/partner/stores/{store_id}/menus:
    get:
      operationId: partner_menus_list
      responses:
        "200":
          description: List menus
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MenuList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-PARTNER
      summary: List menus
      description: List menus
      x-action-id: list_menus
      x-guards: PASS(Allowlist,Problem,PathParam,Pagination,Security)
      x-rbac-role: partner_catalog
      parameters:
        - name: store_id
          in: path
          required: true
          schema:
            type: string
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
    post:
      operationId: partner_menus_create
      responses:
        "201":
          description: Create menu
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Menu"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-PARTNER
      summary: Create menu
      description: Create menu
      x-action-id: create_menu
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Security)
      x-rbac-role: partner_catalog
      parameters:
        - name: store_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MenuCreate"
  /api/partner/stores/{store_id}/menus/{menu_id}/items:
    get:
      operationId: partner_menu_items_list
      responses:
        "200":
          description: List items in menu
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ItemList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-PARTNER
      summary: List items in menu
      description: List items in menu
      x-action-id: list_items
      x-guards: PASS(Allowlist,Problem,PathParam,Pagination,Security)
      x-rbac-role: partner_catalog
      parameters:
        - name: store_id
          in: path
          required: true
          schema:
            type: string
        - name: menu_id
          in: path
          required: true
          schema:
            type: string
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
  /api/partner/stores/{store_id}/menus/{menu_id}/items/{item_id}:
    put:
      operationId: partner_menu_items_upsert
      responses:
        "200":
          description: Create or update item
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Item"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-PARTNER
      summary: Create or update item
      description: Create or update item
      x-action-id: upsert_item
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Security)
      x-rbac-role: partner_catalog
      parameters:
        - name: store_id
          in: path
          required: true
          schema:
            type: string
        - name: menu_id
          in: path
          required: true
          schema:
            type: string
        - name: item_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ItemUpsert"
  /api/partner/stores/{store_id}/orders:
    get:
      operationId: partner_orders_list
      responses:
        "200":
          description: List orders with filters
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OrderList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-PARTNER
      summary: List orders with filters
      description: List orders with filters
      x-action-id: list_orders
      x-guards: PASS(Allowlist,Problem,PathParam,Pagination,Security)
      x-rbac-role: partner_orders
      parameters:
        - name: store_id
          in: path
          required: true
          schema:
            type: string
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
  /api/partner/stores/{store_id}/orders/{order_id}:
    get:
      operationId: partner_order_get
      responses:
        "200":
          description: Order details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Order"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-PARTNER
      summary: Order details
      description: Order details
      x-action-id: load_order
      x-guards: PASS(Allowlist,Problem,PathParam,Security)
      x-rbac-role: partner_orders
      parameters:
        - name: store_id
          in: path
          required: true
          schema:
            type: string
        - name: order_id
          in: path
          required: true
          schema:
            type: string
  /api/partner/stores/{store_id}/orders/{order_id}/accept:
    post:
      operationId: partner_order_accept
      responses:
        "200":
          description: Accept order
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Order"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-PARTNER
      summary: Accept order
      description: Accept order
      x-action-id: accept_order
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Security)
      x-rbac-role: partner_orders
      parameters:
        - name: store_id
          in: path
          required: true
          schema:
            type: string
        - name: order_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/OrderAccept"
  /api/partner/stores/{store_id}/orders/{order_id}/ready:
    post:
      operationId: partner_order_ready
      responses:
        "200":
          description: Mark order as ready for pickup/delivery
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Order"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-PARTNER
      summary: Mark order as ready for pickup/delivery
      description: Mark order as ready for pickup/delivery
      x-action-id: mark_ready
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Security)
      x-rbac-role: partner_orders
      parameters:
        - name: store_id
          in: path
          required: true
          schema:
            type: string
        - name: order_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/OrderReady"
  /api/partner/stores/{store_id}/orders/{order_id}/reject:
    post:
      operationId: partner_order_reject
      responses:
        "200":
          description: Reject order with reason
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Order"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-PARTNER
      summary: Reject order with reason
      description: Reject order with reason
      x-action-id: reject_order
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Security)
      x-rbac-role: partner_orders
      parameters:
        - name: store_id
          in: path
          required: true
          schema:
            type: string
        - name: order_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/OrderReject"
  /api/partner/stores/{store_id}/pricing-profiles:
    put:
      operationId: partner_pricing_profiles_upsert
      responses:
        "200":
          description: Create or update pricing profiles
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PricingProfiles"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-PARTNER
      summary: Create or update pricing profiles
      description: Create or update pricing profiles
      x-action-id: upsert_pricing
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Security)
      x-rbac-role: partner_owner
      parameters:
        - name: store_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PricingProfilesUpsert"
  /api/partner/stores/{store_id}/promotions:
    get:
      operationId: partner_promotions_list
      responses:
        "200":
          description: List promotions
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PromotionList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-PARTNER
      summary: List promotions
      description: List promotions
      x-action-id: list_promotions
      x-guards: PASS(Allowlist,Problem,PathParam,Pagination,Security)
      x-rbac-role: partner_marketing
      parameters:
        - name: store_id
          in: path
          required: true
          schema:
            type: string
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
    post:
      operationId: partner_promotions_create
      responses:
        "201":
          description: Create promotion
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Promotion"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-PARTNER
      summary: Create promotion
      description: Create promotion
      x-action-id: create_promotion
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Security)
      x-rbac-role: partner_marketing
      parameters:
        - name: store_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PromotionCreate"
  /api/ssot/decisions:
    get:
      operationId: ssot_decisions_list
      responses:
        "200":
          description: List decisions with pagination and filters.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DecisionList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-SSOT
      summary: List decisions with pagination and filters.
      description: List decisions with pagination and filters.
      x-action-id: list_decisions
      x-entity-code: SRV-SSOT-01
      x-guards: PASS(Allowlist,Problem,Pagination)
      x-rbac-role: admin
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
    post:
      operationId: ssot_decisions_create
      responses:
        "201":
          description: Create a new decision record, immutable with audit trail.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Decision"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-SSOT
      summary: Create a new decision record, immutable with audit trail.
      description: Create a new decision record, immutable with audit trail.
      x-action-id: create_decision
      x-entity-code: SRV-SSOT-01
      x-guards: PASS(Idem,Allowlist,Problem,Audit-Immutable)
      x-rbac-role: admin
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/DecisionCreate"
  /api/ssot/guards/report:
    get:
      operationId: ssot_guards_report_get
      responses:
        "200":
          description: Fetch latest guards report and metrics.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GuardsReport"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-SSOT
      summary: Fetch latest guards report and metrics.
      description: Fetch latest guards report and metrics.
      x-action-id: open_report
      x-entity-code: SRV-SSOT-01
      x-guards: PASS(Allowlist,Problem)
      x-rbac-role: admin
  /api/ssot/guards/run:
    post:
      operationId: ssot_guards_run
      responses:
        "202":
          description: Trigger guards execution with scope selection. Step-Up required.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GuardsReport"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-SSOT
      summary: Trigger guards execution with scope selection. Step-Up required.
      description: Trigger guards execution with scope selection. Step-Up required.
      x-action-id: run_guards
      x-entity-code: SRV-SSOT-01
      x-guards: PASS(Idem,Allowlist,Problem,Step-Up)
      x-rbac-role: admin
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RunGuardsRequest"
  /api/ssot/inbound:
    post:
      operationId: ssot_inbound_webhook
      responses:
        "200":
          description: Inbound provider webhook with HMAC and anti-replay.
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security: []
      tags:
        - DASH-SSOT
      summary: Inbound provider webhook with HMAC and anti-replay.
      description: Inbound provider webhook with HMAC and anti-replay.
      x-action-id: inbound_webhook
      x-entity-code: SRV-SSOT-01
      x-guards: PASS(Webhook-HMAC,Anti-Replay≤300s,Allowlist,Problem)
      x-rbac-role: system
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/InboundWebhook"
  /api/ssot/index:
    get:
      operationId: ssot_index_get
      responses:
        "200":
          description: Fetch global SSOT index summary with locks and guards status.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SSOTIndex"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-SSOT
      summary: Fetch global SSOT index summary with locks and guards status.
      description: Fetch global SSOT index summary with locks and guards status.
      x-action-id: load_index
      x-entity-code: SRV-SSOT-01
      x-guards: PASS(Allowlist,Problem)
      x-rbac-role: admin
    put:
      operationId: ssot_index_put
      responses:
        "200":
          description: Update SSOT index fields (locked services/apps, guards).
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SSOTIndex"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-SSOT
      summary: Update SSOT index fields (locked services/apps, guards).
      description: Update SSOT index fields (locked services/apps, guards).
      x-action-id: update_index
      x-entity-code: SRV-SSOT-01
      x-guards: PASS(Idem,Allowlist,Problem)
      x-rbac-role: admin
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SSOTIndexUpdate"
  /api/ssot/registry/chats:
    get:
      operationId: ssot_registry_chats_list
      responses:
        "200":
          description: List chat registry entries and link status.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ChatRegistryList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-SSOT
      summary: List chat registry entries and link status.
      description: List chat registry entries and link status.
      x-action-id: list_chats
      x-entity-code: SRV-SSOT-01
      x-guards: PASS(Allowlist,Problem,Pagination)
      x-rbac-role: admin
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
  /api/ssot/registry/patch:
    post:
      operationId: ssot_registry_patch
      responses:
        "200":
          description: Apply chat registry patch (append-only).
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RegistryPatchResult"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-SSOT
      summary: Apply chat registry patch (append-only).
      description: Apply chat registry patch (append-only).
      x-action-id: apply_patch
      x-entity-code: SRV-SSOT-01
      x-guards: PASS(Idem,Allowlist,Problem,Audit-Immutable)
      x-rbac-role: admin
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RegistryPatch"
  /api/ssot/snapshots:
    post:
      operationId: ssot_snapshots_create
      responses:
        "201":
          description: Produce a pre/post snapshot with SHA256 of artifacts.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Snapshot"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-SSOT
      summary: Produce a pre/post snapshot with SHA256 of artifacts.
      description: Produce a pre/post snapshot with SHA256 of artifacts.
      x-action-id: create_snapshot
      x-entity-code: SRV-SSOT-01
      x-guards: PASS(Idem,Allowlist,Problem)
      x-rbac-role: admin
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SnapshotCreate"
  /crm/support/export/masked:
    post:
      operationId: crm_support_export_masked
      responses:
        "201":
          description: Export masked dataset only
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ExportJob"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-SUPPORT
      summary: Export masked dataset only
      description: Export masked dataset only
      x-action-id: export_masked
      x-entity-code: DASH-SUPPORT
      x-guards: PASS(Idem,Allowlist,Problem,Privacy-Export,Step-Up)
      x-rbac-role: support_manager
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ExportRequest"
  /crm/support/inbound/events:
    post:
      operationId: crm_support_inbound_webhook
      responses:
        "200":
          description: Inbound provider webhook events
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security: []
      tags:
        - DASH-SUPPORT
      summary: Inbound provider webhook events
      description: Inbound provider webhook events
      x-action-id: inbound_events
      x-entity-code: DASH-SUPPORT
      x-guards: PASS(Webhook-HMAC,Anti-Replay≤300s,Allowlist,Problem,Audit-Immutable)
      x-rbac-role: system
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/InboundSupportEvent"
  /crm/support/tickets:
    get:
      operationId: crm_support_tickets_list
      responses:
        "200":
          description: List tickets with filters and pagination
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TicketList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-SUPPORT
      summary: List tickets with filters and pagination
      description: List tickets with filters and pagination
      x-action-id: search_tickets
      x-entity-code: DASH-SUPPORT
      x-guards: PASS(Allowlist,Problem,Pagination)
      x-rbac-role: support
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
  /crm/support/tickets/{ticket_id}:
    get:
      operationId: crm_support_ticket_get
      responses:
        "200":
          description: Get ticket details and timeline
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Ticket"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-SUPPORT
      summary: Get ticket details and timeline
      description: Get ticket details and timeline
      x-action-id: load_ticket
      x-entity-code: DASH-SUPPORT
      x-guards: PASS(Allowlist,Problem,PathParam)
      x-rbac-role: support
      parameters:
        - name: ticket_id
          in: path
          required: true
          schema:
            type: string
  /crm/support/tickets/{ticket_id}/assign:
    post:
      operationId: crm_support_ticket_assign
      responses:
        "200":
          description: Assign or reassign ticket owner
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Ticket"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-SUPPORT
      summary: Assign or reassign ticket owner
      description: Assign or reassign ticket owner
      x-action-id: assign_owner
      x-entity-code: DASH-SUPPORT
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Audit-Immutable)
      x-rbac-role: support_manager
      parameters:
        - name: ticket_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AssignOwnerRequest"
  /crm/support/tickets/{ticket_id}/attachments:
    post:
      operationId: crm_support_ticket_attachment_upload
      responses:
        "200":
          description: Upload attachment with antivirus scan
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Attachment"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-SUPPORT
      summary: Upload attachment with antivirus scan
      description: Upload attachment with antivirus scan
      x-action-id: upload_attachment
      x-entity-code: DASH-SUPPORT
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Scan-AV)
      x-rbac-role: support
      parameters:
        - name: ticket_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AttachmentUploadRequest"
  /crm/support/tickets/{ticket_id}/chat/redact:
    post:
      operationId: crm_support_chat_redact
      responses:
        "200":
          description: Redact PII from chat transcript
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ChatRedactResult"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-SUPPORT
      summary: Redact PII from chat transcript
      description: Redact PII from chat transcript
      x-action-id: redact_chat
      x-entity-code: DASH-SUPPORT
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Privacy-Export,Audit-Immutable)
      x-rbac-role: support_privacy
      parameters:
        - name: ticket_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChatRedactRequest"
  /crm/support/tickets/{ticket_id}/notes:
    get:
      operationId: crm_support_ticket_notes_list
      responses:
        "200":
          description: List ticket notes with cursor
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NoteList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-SUPPORT
      summary: List ticket notes with cursor
      description: List ticket notes with cursor
      x-action-id: list_notes
      x-entity-code: DASH-SUPPORT
      x-guards: PASS(Allowlist,Problem,PathParam,Pagination)
      x-rbac-role: support
      parameters:
        - name: ticket_id
          in: path
          required: true
          schema:
            type: string
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
    post:
      operationId: crm_support_ticket_notes_create
      responses:
        "201":
          description: Add encrypted internal note
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Note"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-SUPPORT
      summary: Add encrypted internal note
      description: Add encrypted internal note
      x-action-id: add_note
      x-entity-code: DASH-SUPPORT
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Privacy-Export)
      x-rbac-role: support
      parameters:
        - name: ticket_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/NoteCreateRequest"
  /crm/support/tickets/{ticket_id}/status:
    patch:
      operationId: crm_support_ticket_status_update
      responses:
        "200":
          description: Update ticket status with Step-Up
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Ticket"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-SUPPORT
      summary: Update ticket status with Step-Up
      description: Update ticket status with Step-Up
      x-action-id: update_status
      x-entity-code: DASH-SUPPORT
      x-guards: PASS(Idem,Allowlist,Problem,PathParam,Step-Up,Audit-Immutable)
      x-rbac-role: support_manager
      parameters:
        - name: ticket_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TicketStatusUpdate"
  /dash/qa/policies:
    patch:
      operationId: qa_policies_update
      description: Updates QA policy thresholds and rules used by automation.
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Policy"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-QA
      x-action-id: qa_policies_update
      x-entity-code: DASH-QA
      x-guards: PASS(Allowlist,Problem,Security,Idem)
      x-rbac-role: qa_manager
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PolicyUpdate"
  /dash/qa/runs:
    get:
      operationId: qa_runs_list
      description: Lists recent QA runs with pagination for audit and review.
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/QaRunList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-QA
      x-action-id: qa_runs_list
      x-entity-code: DASH-QA
      x-guards: PASS(Allowlist,Problem,Security,Idem,Pagination)
      x-rbac-role: qa_manager
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
    post:
      operationId: qa_runs_create
      description: Creates a new QA run to evaluate service quality scenarios.
      responses:
        "201":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/QaRun"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-QA
      x-action-id: qa_runs_create
      x-entity-code: DASH-QA
      x-guards: PASS(Allowlist,Problem,Security,Idem)
      x-rbac-role: qa_manager
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateRunRequest"
  /dash/qa/runs/history:
    get:
      operationId: qa_runs_history
      description: Retrieves historical QA runs including archived evaluations.
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/QaRunHistory"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-QA
      x-action-id: qa_runs_history
      x-entity-code: DASH-QA
      x-guards: PASS(Allowlist,Problem,Security,Idem,Pagination)
      x-rbac-role: qa_manager
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
  /dash/qa/runs/{run_id}:
    get:
      operationId: qa_runs_get
      description: Fetches the details and results for the specified QA run.
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/QaRun"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-QA
      x-action-id: qa_runs_get
      x-entity-code: DASH-QA
      x-guards: PASS(Allowlist,Problem,Security,Idem)
      x-rbac-role: qa_manager
      parameters:
        - name: run_id
          in: path
          required: true
          schema:
            type: string
  /dash/qa/runs/{run_id}/approve:
    post:
      operationId: qa_runs_approve
      description: Approves a QA run after managerial review.
      responses:
        "202":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/QaRun"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-QA
      x-action-id: qa_runs_approve
      x-entity-code: DASH-QA
      x-guards: PASS(Allowlist,Problem,Security,Idem)
      x-rbac-role: qa_manager
      parameters:
        - name: run_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ApproveRequest"
  /dash/qa/runs/{run_id}/execute:
    post:
      operationId: qa_runs_execute
      description: Triggers execution of QA test cases for the specified run.
      responses:
        "202":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/QaRun"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-QA
      x-action-id: qa_runs_execute
      x-entity-code: DASH-QA
      x-guards: PASS(Allowlist,Problem,Security,Idem)
      x-rbac-role: qa_manager
      parameters:
        - name: run_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ExecuteRequest"
  /dash/qa/runs/{run_id}/reject:
    post:
      operationId: qa_runs_reject
      description: Rejects a QA run and captures the rejection rationale.
      responses:
        "202":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/QaRun"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-QA
      x-action-id: qa_runs_reject
      x-entity-code: DASH-QA
      x-guards: PASS(Allowlist,Problem,Security,Idem)
      x-rbac-role: qa_manager
      parameters:
        - name: run_id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RejectRequest"
  /dash/qa/runs/{run_id}/report:
    get:
      operationId: qa_runs_report_download
      description: Provides the downloadable QA report artifact for the run.
      responses:
        "200":
          description: Success
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-QA
      x-action-id: qa_runs_report_download
      x-entity-code: DASH-QA
      x-guards: PASS(Allowlist,Problem,Security,Idem)
      x-rbac-role: qa_manager
      parameters:
        - name: run_id
          in: path
          required: true
          schema:
            type: string
  /dash/qa/webhooks/ci:
    post:
      operationId: qa_ci_webhook_receive
      description: Receives QA execution results from CI pipelines with security controls.
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Ack"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-QA
      x-action-id: qa_ci_webhook_receive
      x-entity-code: DASH-QA
      x-guards: PASS(Allowlist,Problem,Security,Idem)
      x-rbac-role: qa_manager
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CiWebhookPayload"
  /fin/cod/controls:
    patch:
      operationId: fin_cod_controls_update
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CODControls"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-FIN
      summary: Update COD settlement controls.
      description: Updates cash-on-delivery risk controls and thresholds managed by finance.
      x-action-id: update_cod_controls
      x-guards: PASS(Idem,Allowlist,Problem,Step-Up)
      x-rbac-role: finance
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CODControlsUpdate"
  /fin/exports:
    post:
      operationId: fin_export_create
      responses:
        "201":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Export"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-FIN
      summary: Create finance export job.
      description: Starts an asynchronous finance export and returns its tracking reference.
      x-action-id: create_export
      x-guards: PASS(Idem,Allowlist,Problem,Privacy-Export)
      x-rbac-role: finance
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ExportCreateRequest"
  /fin/exports/{id}:
    get:
      operationId: fin_export_get
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Export"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-FIN
      summary: Fetch finance export details.
      description: Loads the status and download metadata for a finance export job.
      x-action-id: get_export
      x-guards: PASS(Allowlist,Problem,PathParam)
      x-rbac-role: finance
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
  /fin/ledger/entries:
    get:
      operationId: fin_ledger_entries_list
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LedgerEntryList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-FIN
      summary: List general ledger entries.
      description: Provides paginated general ledger entries filtered by cursor parameters.
      x-action-id: list_ledger
      x-guards: PASS(Allowlist,Problem,Pagination)
      x-rbac-role: finance
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
  /fin/ledger/journal:
    post:
      operationId: fin_journal_post
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/JournalPostResult"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-FIN
      summary: Post manual journal entry.
      description: Records a balanced manual journal entry with audit and step-up controls.
      x-action-id: post_journal_entry
      x-guards: PASS(Idem,Allowlist,Problem,Step-Up,Audit-Immutable)
      x-rbac-role: finance
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/JournalPostRequest"
  /fin/payouts:
    get:
      operationId: fin_payouts_list
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PayoutList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-FIN
      summary: List payout runs.
      description: Returns paginated payout batches with optional cursor controls.
      x-action-id: list_payouts
      x-guards: PASS(Allowlist,Problem,Pagination)
      x-rbac-role: finance
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
    post:
      operationId: fin_payout_create
      responses:
        "201":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Payout"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-FIN
      summary: Create payout run.
      description: Initiates a new payout batch for suppliers with dual approval controls.
      x-action-id: create_payout
      x-guards: PASS(Idem,Allowlist,Problem,Step-Up,DualSign,Audit-Immutable)
      x-rbac-role: finance
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PayoutCreateRequest"
  /fin/payouts/{id}:
    get:
      operationId: fin_payout_get
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Payout"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-FIN
      summary: Fetch payout run details.
      description: Retrieves status, totals, and audit info for a payout batch.
      x-action-id: load_payout
      x-guards: PASS(Allowlist,Problem,PathParam)
      x-rbac-role: finance
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
  /fin/reconcile/run:
    post:
      operationId: fin_reconcile_run
      responses:
        "202":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ReconcileRunResult"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-FIN
      summary: Trigger reconciliation run.
      description: Launches an on-demand reconciliation process across ledgers and payouts.
      x-action-id: run_reconcile
      x-guards: PASS(Idem,Allowlist,Problem,Audit-Immutable)
      x-rbac-role: finance
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ReconcileRunRequest"
  /fin/reports/kpis:
    get:
      operationId: fin_reports_kpis
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/KPIs"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-FIN
      summary: Retrieve finance KPI report.
      description: Returns current finance key performance indicator metrics for dashboards.
      x-action-id: load_fin_kpis
      x-guards: PASS(Allowlist,Problem)
      x-rbac-role: finance
  /fin/settlements:
    get:
      operationId: fin_settlements_list
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SettlementList"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-FIN
      summary: List settlement batches.
      description: Provides paginated settlement batches with filters for finance teams.
      x-action-id: list_settlements
      x-guards: PASS(Allowlist,Problem,Pagination)
      x-rbac-role: finance
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
    post:
      operationId: fin_settlement_create
      responses:
        "201":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Settlement"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-FIN
      summary: Create settlement batch.
      description: Builds a new settlement batch awaiting finance approval.
      x-action-id: create_settlement_batch
      x-guards: PASS(Idem,Allowlist,Problem,Step-Up,Audit-Immutable)
      x-rbac-role: finance
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SettlementCreateRequest"
  /fin/settlements/{id}:
    get:
      operationId: fin_settlement_get
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Settlement"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-FIN
      summary: Fetch settlement batch details.
      description: Retrieves totals, approvals, and status for a settlement batch.
      x-action-id: load_settlement
      x-guards: PASS(Allowlist,Problem,PathParam)
      x-rbac-role: finance
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
  /fin/settlements/{id}/approve:
    post:
      operationId: fin_settlement_approve
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Settlement"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - DASH-FIN
      summary: Approve settlement batch.
      description: Finalizes a settlement batch after dual approval and audit checks.
      x-action-id: approve_settlement
      x-guards: PASS(Idem,PathParam,Step-Up,DualSign,Audit-Immutable)
      x-rbac-role: finance
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ApproveRequest"
  /pay/confirm:
    post:
      operationId: pay_confirm
      responses:
        "200":
          description: Confirm payment after provider callback.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PaymentIntent"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-USER
      summary: Confirm payment after provider callback.
      description: Confirm payment after provider callback.
      x-action-id: pay_confirm
      x-entity-code: SRV-DSH-01
      x-guards: PASS | PASS(Idem,Security,Allowlist,Problem)
      x-rbac-role: user
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PaymentConfirmation"
  /wallet/captures/adjust:
    post:
      operationId: wallet_capture_adjust
      responses:
        "200":
          description: Adjust capture amount for substitutions/returns (server-side)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PaymentIntent"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security: []
      tags:
        - SYSTEM
      summary: Adjust capture amount for substitutions/returns (server-side)
      description: Adjust capture amount for substitutions/returns (server-side)
      x-action-id: dsh_capture_adjust
      x-entity-code: SRV-DSH-01
      x-guards: PASS(Idem,Security,Allowlist,Problem,Audit-Immutable)
      x-rbac-role: system
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CaptureAdjustRequest"
  /wallet/intents:
    post:
      operationId: wallet_intents_create
      responses:
        "201":
          description: Create payment intent for goods amount.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PaymentIntent"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-USER
      summary: Create payment intent for goods amount.
      description: Create payment intent for goods amount.
      x-action-id: wallet_intents_create
      x-entity-code: SRV-DSH-01
      x-guards: PASS | PASS(Idem,Security,Allowlist,Problem)
      x-rbac-role: user
      parameters:
        - $ref: "#/components/parameters/Idempotency-Key"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PaymentIntentRequest"
  /wallet/intents/{id}:
    get:
      operationId: wallet_intents_get
      responses:
        "200":
          description: Poll payment intent status.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PaymentIntent"
        default:
          description: Error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Problem"
      security:
        - bearerAuth: []
      tags:
        - APP-USER
      summary: Poll payment intent status.
      description: Poll payment intent status.
      x-action-id: wallet_intents_get
      x-entity-code: SRV-DSH-01
      x-guards: PASS | PASS(Allowlist,Problem,PathParam)
      x-rbac-role: user
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
  /api/wlt/intents:
    post:
      tags:
        - PaymentIntents
      operationId: wlt_intents_create
      summary: إنشاء نية دفع جديدة لطلب تابع لخدمة DSH أو خدمة أخرى.
      description: Creates a new wallet payment intent for an upstream order while enforcing idempotency.
      x-surface: APP-USER
      x-screen: app_user.checkout.payment
      x-action: create_payment_intent
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/IdempotencyKey"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PaymentIntentCreateRequest"
      responses:
        "201":
          description: تم إنشاء نية الدفع.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PaymentIntent"
        default:
          $ref: "#/components/responses/StandardError"
  /api/wlt/intents/{intent_id}:
    get:
      tags:
        - PaymentIntents
      operationId: wlt_intents_get
      summary: استعلام حالة نية الدفع الحالية.
      description: Retrieves the latest state of an existing wallet payment intent.
      x-surface: APP-USER
      x-screen: app_user.checkout.payment
      x-action: poll_payment_intent
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/IntentId"
      responses:
        "200":
          description: بيانات نية الدفع الحالية.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PaymentIntent"
        default:
          $ref: "#/components/responses/StandardError"
  /api/wlt/intents/{intent_id}/confirm:
    post:
      tags:
        - PaymentConfirmations
      operationId: wlt_intents_confirm
      summary: تأكيد نية الدفع بعد رد مزود الدفع.
      description: Confirms a wallet payment intent using the PSP callback payload.
      x-surface: APP-USER
      x-screen: app_user.checkout.payment
      x-action: confirm_payment
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/IdempotencyKey"
        - $ref: "#/components/parameters/IntentId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PaymentConfirmationRequest"
      responses:
        "200":
          description: تم تأكيد نية الدفع.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PaymentIntent"
        default:
          $ref: "#/components/responses/StandardError"
  /api/wlt/intents/{intent_id}/capture-adjust:
    post:
      tags:
        - Settlements
      operationId: wlt_capture_adjust
      summary: تعديل قيمة الالتقاط بعد تغييرات في الطلب (مثل الاستبدال أو الإرجاع).
      description: Applies a capture delta to align wallet settlement amounts with downstream order changes.
      x-surface: SYSTEM
      x-screen: system.settlements.capture
      x-action: dsh_capture_adjust
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/IdempotencyKey"
        - $ref: "#/components/parameters/IntentId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CaptureAdjustRequest"
      responses:
        "200":
          description: تم تعديل قيمة الالتقاط.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PaymentIntent"
        default:
          $ref: "#/components/responses/StandardError"
  /api/wlt/inbound/refunds:
    post:
      tags:
        - WalletWebhooks
      operationId: wlt_refunds_inbound
      summary: Webhook لاستلام أحداث الاسترداد أو الـ chargeback من مزود الدفع.
      description: Ingests signed refund or chargeback events emitted by the PSP for wallet reconciliation.
      x-surface: SYSTEM
      x-screen: system.webhooks.refunds
      x-action: wlt_refund_webhook
      security:
        - webhookHmac: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/WltRefundWebhook"
      responses:
        "204":
          description: تم قبول الحدث.
        default:
          $ref: "#/components/responses/StandardError"
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
    webhookHmac:
      type: apiKey
      in: header
      name: X-Signature
  parameters:
    Idempotency-Key:
      name: Idempotency-Key
      in: header
      required: true
      schema:
        type: string
      description: Idempotency key for safely retrying requests.
    IdempotencyKey:
      name: Idempotency-Key
      in: header
      required: true
      schema:
        type: string
      description: مفتاح يساعد على ضمان عدم تكرار عمليات الكتابة.
    IntentId:
      name: intent_id
      in: path
      required: true
      schema:
        type: string
      description: معرّف نية الدفع داخل WLT.
  responses:
    StandardError:
      description: RFC7807 problem+json envelope for error responses.
      content:
        application/problem+json:
          schema:
            $ref: "#/components/schemas/Problem"
          examples:
            canonical:
              summary: Canonical problem response
              description: Canonical problem response
              value:
                type: https://errors.bthwani.com/common/unexpected_error
                title: Unexpected error
                status: 500
                code: SVR-500-UNEXPECTED
                detail: An unexpected error occurred. Please retry.
                traceId: "00000000000000000000000000000000"
                errors: []
  examples:
    ProblemExample:
      summary: Sanitized problem payload without PII
      description: Sanitized problem payload without PII
      value:
        type: https://errors.bthwani.com/dsh/order_conflict
        title: Order cannot be modified
        status: 409
        code: DSH-409-ORDER-LOCKED
        detail: The order is already assigned to another captain.
        traceId: 0
        errors:
          - field: state
            message: State transition not allowed from DELIVERED.
  schemas:
    AcceptOrderRequest:
      type: object
      description: Placeholder schema for AcceptOrderRequest.
    Ack:
      type: object
      description: Placeholder schema for Ack.
    AdminOrderList:
      type: object
      description: Placeholder schema for AdminOrderList.
    AdminPartner:
      type: object
      description: Placeholder schema for AdminPartner.
    AdminPartnerApproveRequest:
      type: object
      description: Placeholder schema for AdminPartnerApproveRequest.
    AdminPartnerList:
      type: object
      description: Placeholder schema for AdminPartnerList.
    AdminPartnerRejectRequest:
      type: object
      description: Placeholder schema for AdminPartnerRejectRequest.
    AdminUser:
      type: object
      description: Placeholder schema for AdminUser.
    AdminUserList:
      type: object
      description: Placeholder schema for AdminUserList.
    Alert:
      type: object
      description: Placeholder schema for Alert.
    AlertCreateRequest:
      type: object
      description: Placeholder schema for AlertCreateRequest.
    AlertList:
      type: object
      description: Placeholder schema for AlertList.
    AlertUpdateRequest:
      type: object
      description: Placeholder schema for AlertUpdateRequest.
    ApproveRequest:
      type: object
      description: Placeholder schema for ApproveRequest.
    AssignCaptainRequest:
      type: object
      description: Placeholder schema for AssignCaptainRequest.
    AssignOrderRequest:
      type: object
      description: Placeholder schema for AssignOrderRequest.
    AssignOwnerRequest:
      type: object
      description: Placeholder schema for AssignOwnerRequest.
    AssignRequest:
      type: object
      description: Placeholder schema for AssignRequest.
    AssignRoleRequest:
      type: object
      description: Placeholder schema for AssignRoleRequest.
    Assignment:
      type: object
      description: Placeholder schema for Assignment.
    Attachment:
      type: object
      description: Placeholder schema for Attachment.
    AttachmentUploadRequest:
      type: object
      description: Placeholder schema for AttachmentUploadRequest.
    AttendanceAdjustRequest:
      type: object
      description: Placeholder schema for AttendanceAdjustRequest.
    AttendanceRange:
      type: object
      description: Placeholder schema for AttendanceRange.
    AttendanceRecord:
      type: object
      description: Placeholder schema for AttendanceRecord.
    AuditLogList:
      type: object
      description: Placeholder schema for AuditLogList.
    AvailabilityToggle:
      type: object
      description: Placeholder schema for AvailabilityToggle.
    BankInfo:
      type: object
      description: Placeholder schema for BankInfo.
    Benefit:
      type: object
      description: Placeholder schema for Benefit.
    BenefitList:
      type: object
      description: Placeholder schema for BenefitList.
    BenefitUpdateRequest:
      type: object
      description: Placeholder schema for BenefitUpdateRequest.
    CODControls:
      type: object
      description: Placeholder schema for CODControls.
    CODControlsUpdate:
      type: object
      description: Placeholder schema for CODControlsUpdate.
    Campaign:
      type: object
      description: Placeholder schema for Campaign.
    CampaignCreateRequest:
      type: object
      description: Placeholder schema for CampaignCreateRequest.
    CampaignList:
      type: object
      description: Placeholder schema for CampaignList.
    CampaignSendRequest:
      type: object
      description: Placeholder schema for CampaignSendRequest.
    CampaignUpdateRequest:
      type: object
      description: Placeholder schema for CampaignUpdateRequest.
    CancelReasonList:
      type: object
      description: Placeholder schema for CancelReasonList.
    CaptainAcceptRequest:
      type: object
      description: Placeholder schema for CaptainAcceptRequest.
    CaptainApprovalRequest:
      type: object
      description: Placeholder schema for CaptainApprovalRequest.
    CaptainArrivedCustomer:
      type: object
      description: Placeholder schema for CaptainArrivedCustomer.
    CaptainArrivedStore:
      type: object
      description: Placeholder schema for CaptainArrivedStore.
    CaptainAvailability:
      type: object
      description: Placeholder schema for CaptainAvailability.
    CaptainDeliveredRequest:
      type: object
      description: Placeholder schema for CaptainDeliveredRequest.
    CaptainEarnings:
      type: object
      description: Placeholder schema for CaptainEarnings.
    CaptainLocationList:
      type: object
      description: Placeholder schema for CaptainLocationList.
    CaptainLocationUpdate:
      type: object
      description: Placeholder schema for CaptainLocationUpdate.
    CaptainOrder:
      type: object
      description: Placeholder schema for CaptainOrder.
    CaptainOrderList:
      type: object
      description: Placeholder schema for CaptainOrderList.
    CaptainPickedUp:
      type: object
      description: Placeholder schema for CaptainPickedUp.
    CaptainProfile:
      type: object
      description: Placeholder schema for CaptainProfile.
    CaptainRejectRequest:
      type: object
      description: Placeholder schema for CaptainRejectRequest.
    CaptainRejectionRequest:
      type: object
      description: Placeholder schema for CaptainRejectionRequest.
    CaptainStatus:
      type: object
      description: Placeholder schema for CaptainStatus.
    CaptureAdjustRequest:
      type: object
      additionalProperties: false
      required:
        - delta_amount
        - reason_code
      properties:
        delta_amount:
          type: integer
          description: الفرق الذي سيتم تطبيقه على الالتقاط (يمكن أن يكون سالبًا).
        reason_code:
          type: string
          enum:
            - substitution
            - partial_out_of_stock
            - customer_return
            - manual_adjustment
        notes:
          type: string
          maxLength: 256
          description: تعليق اختياري من النظام المستهلك (مثل DSH).
    ChannelTestResult:
      type: object
      description: Placeholder schema for ChannelTestResult.
    ChatList:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/ChatMessage"
        next_cursor:
          type: string
          nullable: true
    ChatMessage:
      type: object
      description: Masked chat message exchanged around an order.
      required:
        - id
        - sender_role
        - content
        - sent_at
      properties:
        id:
          type: string
        sender_role:
          type: string
          enum:
            - customer
            - partner
            - captain
            - ops
        content:
          type: string
        masked:
          type: boolean
          default: true
        attachments:
          type: array
          items:
            type: string
            format: uri
        sent_at:
          type: string
          format: date-time
    ChatReadAckRequest:
      type: object
      properties:
        last_message_id:
          type: string
        read_at:
          type: string
          format: date-time
    ChatRedactRequest:
      type: object
      description: Placeholder schema for ChatRedactRequest.
    ChatRedactResult:
      type: object
      description: Placeholder schema for ChatRedactResult.
    ChatRegistryList:
      type: object
      description: Placeholder schema for ChatRegistryList.
    ChatSend:
      type: object
      description: Placeholder schema for ChatSend.
    ChatSendRequest:
      type: object
      description: Placeholder schema for ChatSendRequest.
    ChatThreadList:
      type: object
      description: Placeholder schema for ChatThreadList.
    CiWebhookPayload:
      type: object
      description: Placeholder schema for CiWebhookPayload.
    CommissionPolicy:
      type: object
      description: Placeholder schema for CommissionPolicy.
    ConsentState:
      type: object
      description: Placeholder schema for ConsentState.
    Contract:
      type: object
      description: Placeholder schema for Contract.
    ContractCreateRequest:
      type: object
      description: Placeholder schema for ContractCreateRequest.
    ContractList:
      type: object
      description: Placeholder schema for ContractList.
    ContractUpdateRequest:
      type: object
      description: Placeholder schema for ContractUpdateRequest.
    Coupon:
      type: object
      description: Placeholder schema for Coupon.
    CouponCreate:
      type: object
      description: Placeholder schema for CouponCreate.
    CouponList:
      type: object
      description: Placeholder schema for CouponList.
    CreateRunRequest:
      type: object
      description: Placeholder schema for CreateRunRequest.
    CrmReplyRequest:
      type: object
      description: Placeholder schema for CrmReplyRequest.
    Customer:
      type: object
      description: Placeholder schema for Customer.
    CustomerList:
      type: object
      description: Placeholder schema for CustomerList.
    Dashboard:
      type: object
      description: Placeholder schema for Dashboard.
    DashboardList:
      type: object
      description: Placeholder schema for DashboardList.
    DashboardMetrics:
      type: object
      description: Placeholder schema for DashboardMetrics.
    Decision:
      type: object
      description: Placeholder schema for Decision.
    DecisionCreate:
      type: object
      description: Placeholder schema for DecisionCreate.
    DecisionList:
      type: object
      description: Placeholder schema for DecisionList.
    DeliveryModes:
      type: object
      description: Placeholder schema for DeliveryModes.
    DeliveryModesSet:
      type: object
      description: Placeholder schema for DeliveryModesSet.
    DispatchOrderList:
      type: object
      description: Placeholder schema for DispatchOrderList.
    DisputeList:
      type: object
      description: Placeholder schema for DisputeList.
    Document:
      type: object
      description: Placeholder schema for Document.
    DocumentUpload:
      type: object
      description: Placeholder schema for DocumentUpload.
    Employee:
      type: object
      description: Placeholder schema for Employee.
    EmployeeCreateRequest:
      type: object
      description: Placeholder schema for EmployeeCreateRequest.
    EmployeeDeactivateRequest:
      type: object
      description: Placeholder schema for EmployeeDeactivateRequest.
    EmployeeList:
      type: object
      description: Placeholder schema for EmployeeList.
    EmployeeUpdateRequest:
      type: object
      description: Placeholder schema for EmployeeUpdateRequest.
    Empty:
      type: object
      description: Empty response body
    Eta:
      type: object
      description: Placeholder schema for Eta.
    ExecuteRequest:
      type: object
      description: Placeholder schema for ExecuteRequest.
    Export:
      type: object
      description: Placeholder schema for Export.
    ExportCreateRequest:
      type: object
      description: Placeholder schema for ExportCreateRequest.
    ExportDryRun:
      type: object
      description: Placeholder schema for ExportDryRun.
    ExportJob:
      type: object
      description: Placeholder schema for ExportJob.
    ExportReceipt:
      type: object
      description: Placeholder schema for ExportReceipt.
    ExportRequest:
      type: object
      description: Placeholder schema for ExportRequest.
    ExportTask:
      type: object
      description: Placeholder schema for ExportTask.
    FeatureFlag:
      type: object
      description: Placeholder schema for FeatureFlag.
    FeatureFlagList:
      type: object
      description: Placeholder schema for FeatureFlagList.
    FeatureFlagToggleRequest:
      type: object
      description: Placeholder schema for FeatureFlagToggleRequest.
    FeedbackRequest:
      type: object
      description: Placeholder schema for FeedbackRequest.
    ForceOfflineRequest:
      type: object
      description: Placeholder schema for ForceOfflineRequest.
    GuardsReport:
      type: object
      description: Placeholder schema for GuardsReport.
    HandoffRequest:
      type: object
      description: Placeholder schema for HandoffRequest.
    Holiday:
      type: object
      description: Placeholder schema for Holiday.
    HolidayCreateRequest:
      type: object
      description: Placeholder schema for HolidayCreateRequest.
    HolidayList:
      type: object
      description: Placeholder schema for HolidayList.
    HrMetrics:
      type: object
      description: Placeholder schema for HrMetrics.
    ImportResult:
      type: object
      description: Placeholder schema for ImportResult.
    InboundMessage:
      type: object
      description: Placeholder schema for InboundMessage.
    InboundMessageWebhook:
      type: object
      description: Placeholder schema for InboundMessageWebhook.
    InboundSupportEvent:
      type: object
      description: Placeholder schema for InboundSupportEvent.
    InboundWebhook:
      type: object
      description: Placeholder schema for InboundWebhook.
    IncentivesConfig:
      type: object
      description: Placeholder schema for IncentivesConfig.
    IncentivesConfigRequest:
      type: object
      description: Placeholder schema for IncentivesConfigRequest.
    Incident:
      type: object
      description: Placeholder schema for Incident.
    IncidentCreateRequest:
      type: object
      description: Placeholder schema for IncidentCreateRequest.
    IncidentList:
      type: object
      description: Placeholder schema for IncidentList.
    InventoryAdjustRequest:
      type: object
      description: Placeholder schema for InventoryAdjustRequest.
    InventoryAdjustResponse:
      type: object
      description: Placeholder schema for InventoryAdjustResponse.
    InventoryBulk:
      type: object
      description: Placeholder schema for InventoryBulk.
    InventoryBulkResult:
      type: object
      description: Placeholder schema for InventoryBulkResult.
    Item:
      type: object
      description: Placeholder schema for Item.
    ItemList:
      type: object
      description: Placeholder schema for ItemList.
    ItemUpsert:
      type: object
      description: Placeholder schema for ItemUpsert.
    JournalPostRequest:
      type: object
      description: Placeholder schema for JournalPostRequest.
    JournalPostResult:
      type: object
      description: Placeholder schema for JournalPostResult.
    KPIs:
      type: object
      description: Placeholder schema for KPIs.
    KeyRotationRequest:
      type: object
      description: Placeholder schema for KeyRotationRequest.
    KeyRotationResult:
      type: object
      description: Placeholder schema for KeyRotationResult.
    Leave:
      type: object
      description: Placeholder schema for Leave.
    LeaveDecisionRequest:
      type: object
      description: Placeholder schema for LeaveDecisionRequest.
    LeaveList:
      type: object
      description: Placeholder schema for LeaveList.
    LedgerEntryList:
      type: object
      description: Placeholder schema for LedgerEntryList.
    LocationAck:
      type: object
      description: Placeholder schema for LocationAck.
    LocationWebhook:
      type: object
      description: Placeholder schema for LocationWebhook.
    MarkReadyRequest:
      type: object
      description: Placeholder schema for MarkReadyRequest.
    Menu:
      type: object
      description: Placeholder schema for Menu.
    MenuCreate:
      type: object
      description: Placeholder schema for MenuCreate.
    MenuList:
      type: object
      description: Placeholder schema for MenuList.
    MetricList:
      type: object
      description: Placeholder schema for MetricList.
    Note:
      type: object
      description: Placeholder schema for Note.
    NoteCreateRequest:
      type: object
      description: Placeholder schema for NoteCreateRequest.
    NoteList:
      type: object
      description: Placeholder schema for NoteList.
    OptInRequest:
      type: object
      description: Placeholder schema for OptInRequest.
    OptOutRequest:
      type: object
      description: Placeholder schema for OptOutRequest.
    Order:
      type: object
      description: Order aggregate stored in DSH.
      required:
        - id
        - status
        - currency
        - created_at
      properties:
        id:
          type: string
        status:
          type: string
          enum:
            - draft
            - pending_payment
            - confirmed
            - preparing
            - ready
            - en_route
            - delivered
            - completed
            - canceled
        channel:
          type: string
          enum:
            - platform
            - partner
            - dark_store
            - field
            - ops
        payment_status:
          type: string
          enum:
            - pending
            - authorized
            - captured
            - refunded
            - failed
        items:
          type: array
          items:
            $ref: "#/components/schemas/OrderItem"
        pricing:
          $ref: "#/components/schemas/PricingBreakdown"
        currency:
          type: string
          minLength: 3
          maxLength: 3
        customer:
          $ref: "#/components/schemas/ContactReference"
        delivery_address:
          $ref: "#/components/schemas/Address"
        slot:
          $ref: "#/components/schemas/SlotWindow"
        pickup_code:
          type: string
        timeline:
          type: array
          items:
            $ref: "#/components/schemas/TimelineEvent"
        notes:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    OrderAccept:
      type: object
      description: Placeholder schema for OrderAccept.
    OrderAdminView:
      type: object
      description: Placeholder schema for OrderAdminView.
    OrderCancelRequest:
      type: object
      description: Request payload used to cancel an order within the allowed window.
      required:
        - reason_code
      properties:
        reason_code:
          type: string
          enum:
            - change_of_mind
            - found_better_price
            - delay
            - other
        notes:
          type: string
    OrderCreateRequest:
      type: object
      description: Payload used to create a new delivery order.
      required:
        - channel
        - items
        - payment_method
      properties:
        channel:
          type: string
          enum:
            - platform
            - partner
            - dark_store
        quote_id:
          type: string
          description: Identifier of a previously generated quote.
        items:
          type: array
          items:
            $ref: "#/components/schemas/OrderItemRequest"
          minItems: 1
        delivery_address:
          $ref: "#/components/schemas/Address"
        customer:
          $ref: "#/components/schemas/ContactReference"
        slot_id:
          type: string
          description: Selected delivery/pickup slot identifier.
        payment_method:
          type: string
          enum:
            - wallet
            - cod
            - prepaid
            - partner_invoice
        notes:
          type: string
        metadata:
          type: object
          additionalProperties:
            type: string
    OrderList:
      type: object
      description: Paginated list of orders for the requesting subject.
      required:
        - items
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/Order"
        next_cursor:
          type: string
          nullable: true
    OrderReady:
      type: object
      description: Placeholder schema for OrderReady.
    OrderReject:
      type: object
      description: Placeholder schema for OrderReject.
    OrderTimeline:
      type: object
      description: Timeline events associated with an order.
      properties:
        order_id:
          type: string
        events:
          type: array
          items:
            $ref: "#/components/schemas/TimelineEvent"
    OrderUpdateRequest:
      type: object
      description: Request to update mutable order fields after creation.
      properties:
        slot_id:
          type: string
        notes:
          type: string
        customer_note:
          type: string
        metadata:
          type: object
          additionalProperties:
            type: string
    Overview:
      type: object
      description: Placeholder schema for Overview.
    Partner:
      type: object
      description: Partner aggregate including metadata and store summaries.
      required:
        - id
        - legal_name
        - status
      properties:
        id:
          type: string
        legal_name:
          type: string
        trade_name:
          type: string
        status:
          type: string
          enum:
            - draft
            - in_review
            - active
            - suspended
            - archived
        segments:
          type: array
          items:
            type: string
        primary_contact:
          $ref: "#/components/schemas/ContactReference"
        stores:
          type: array
          items:
            type: object
            required:
              - id
              - name
              - status
            properties:
              id:
                type: string
              name:
                type: string
              status:
                type: string
                enum:
                  - draft
                  - pending
                  - active
                  - inactive
              city:
                type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    PartnerCreateRequest:
      type: object
      required:
        - legal_name
        - primary_contact
      properties:
        legal_name:
          type: string
        trade_name:
          type: string
        segments:
          type: array
          items:
            type: string
        primary_contact:
          $ref: "#/components/schemas/ContactReference"
        metadata:
          type: object
          additionalProperties:
            type: string
    PartnerIdentity:
      type: object
      description: Placeholder schema for PartnerIdentity.
    PartnerIntake:
      type: object
      description: Placeholder schema for PartnerIntake.
    PartnerIntakeStart:
      type: object
      description: Placeholder schema for PartnerIntakeStart.
    PartnerList:
      type: object
      description: Placeholder schema for PartnerList.
    PartnerNotifyRequest:
      type: object
      required:
        - channel
        - body
      properties:
        channel:
          type: string
          enum:
            - sms
            - whatsapp
            - email
            - push
        subject:
          type: string
        body:
          type: string
        tags:
          type: array
          items:
            type: string
        metadata:
          type: object
          additionalProperties:
            type: string
    PartnerOnboardingList:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/Partner"
        next_cursor:
          type: string
          nullable: true
    PartnerPendingList:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/Partner"
        next_cursor:
          type: string
          nullable: true
    PartnerPolicies:
      type: object
      description: Delivery/payment policies configured per partner.
      properties:
        platform_delivery_enabled:
          type: boolean
        partner_delivery_enabled:
          type: boolean
        pickup_enabled:
          type: boolean
        cod_enabled:
          type: boolean
        last_updated_at:
          type: string
          format: date-time
    PartnerPoliciesUpdate:
      type: object
      properties:
        platform_delivery_enabled:
          type: boolean
        partner_delivery_enabled:
          type: boolean
        pickup_enabled:
          type: boolean
        cod_enabled:
          type: boolean
    PartnerStatusWebhook:
      type: object
      properties:
        partner_id:
          type: string
        status:
          type: string
        triggered_at:
          type: string
          format: date-time
        metadata:
          type: object
          additionalProperties:
            type: string
    PartnerUpdateRequest:
      type: object
      properties:
        trade_name:
          type: string
        segments:
          type: array
          items:
            type: string
        primary_contact:
          $ref: "#/components/schemas/ContactReference"
        metadata:
          type: object
          additionalProperties:
            type: string
    PartnerZones:
      type: object
      properties:
        version:
          type: integer
        zones:
          type: array
          items:
            $ref: "#/components/schemas/ZonePolygon"
        updated_at:
          type: string
          format: date-time
    PartnerZonesUpdate:
      type: object
      required:
        - zones
      properties:
        zones:
          type: array
          items:
            $ref: "#/components/schemas/ZonePolygon"
        metadata:
          type: object
          additionalProperties:
            type: string
    PaymentConfirmation:
      type: object
      properties:
        status:
          type: string
          enum:
            - pending
            - confirmed
            - failed
        provider_reference:
          type: string
        reconciliation_reference:
          type: string
        confirmed_at:
          type: string
          format: date-time
    PaymentIntent:
      type: object
      additionalProperties: false
      required:
        - id
        - status
        - amount
        - currency
        - order_reference
        - created_at
      properties:
        id:
          type: string
          maxLength: 64
          description: Identifier of the payment intent within the wallet service.
        status:
          type: string
          enum:
            - requires_payment_method
            - requires_action
            - processing
            - succeeded
            - failed
            - canceled
          description: Current state of the payment intent.
        amount:
          type: integer
          minimum: 0
          description: Amount in the smallest currency unit.
        currency:
          type: string
          minLength: 3
          maxLength: 3
          description: ISO-4217 currency code.
        order_reference:
          type: string
          maxLength: 64
          description: Reference to the source order in the consuming service.
        created_at:
          type: string
          format: date-time
          description: Creation timestamp (ISO 8601).
        updated_at:
          type: string
          format: date-time
          description: Last update timestamp (ISO 8601).
        metadata:
          type: object
          additionalProperties: true
          description: Provider metadata forwarded from the PSP.
    PaymentIntentRequest:
      type: object
      required:
        - amount
        - currency
        - order_reference
      properties:
        amount:
          type: integer
          minimum: 1
        currency:
          type: string
          minLength: 3
          maxLength: 3
        order_reference:
          type: string
        customer_id:
          type: string
        metadata:
          type: object
          additionalProperties:
            type: string
    Payout:
      type: object
      properties:
        id:
          type: string
        status:
          type: string
          enum:
            - queued
            - processing
            - paid
            - failed
        amount:
          $ref: "#/components/schemas/MoneyValue"
        currency:
          type: string
          minLength: 3
          maxLength: 3
        beneficiary:
          type: string
        scheduled_at:
          type: string
          format: date-time
          nullable: true
        completed_at:
          type: string
          format: date-time
          nullable: true
    PayoutCreateRequest:
      type: object
      required:
        - settlement_id
        - amount
      properties:
        settlement_id:
          type: string
        amount:
          $ref: "#/components/schemas/MoneyValue"
        beneficiary:
          type: string
        notes:
          type: string
    PayoutList:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/Payout"
        next_cursor:
          type: string
          nullable: true
    PayoutRequest:
      type: object
      description: Placeholder schema for PayoutRequest.
    PayoutTicket:
      type: object
      description: Placeholder schema for PayoutTicket.
    PayoutsBatch:
      type: object
      description: Placeholder schema for PayoutsBatch.
    PayoutsQueueRequest:
      type: object
      properties:
        run_id:
          type: string
        notes:
          type: string
    PayrollApproveRequest:
      type: object
      properties:
        note:
          type: string
    PayrollBuildRequest:
      type: object
      required:
        - period_start
        - period_end
      properties:
        period_start:
          type: string
          format: date
        period_end:
          type: string
          format: date
        include_incentives:
          type: boolean
          default: true
        notes:
          type: string
    PayrollExportRequest:
      type: object
      properties:
        format:
          type: string
          enum:
            - csv
            - xml
            - bank_file
        bank_code:
          type: string
        mask_sensitive:
          type: boolean
          default: true
    PayrollLockRequest:
      type: object
      properties:
        reason:
          type: string
        requested_by:
          type: string
    PayrollRun:
      type: object
      required:
        - id
        - status
        - period_start
        - period_end
        - created_at
      properties:
        id:
          type: string
        status:
          type: string
          enum:
            - draft
            - building
            - ready_for_review
            - locked
            - approved
            - payout_in_progress
            - completed
        period_start:
          type: string
          format: date
        period_end:
          type: string
          format: date
        total_employees:
          type: integer
          minimum: 0
        gross_total:
          $ref: "#/components/schemas/MoneyValue"
        net_total:
          $ref: "#/components/schemas/MoneyValue"
        currency:
          type: string
          minLength: 3
          maxLength: 3
        created_at:
          type: string
          format: date-time
        locked_at:
          type: string
          format: date-time
          nullable: true
        approved_at:
          type: string
          format: date-time
          nullable: true
    PayrollRunList:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/PayrollRun"
        next_cursor:
          type: string
          nullable: true
    PayrollStatusWebhook:
      type: object
      properties:
        run_id:
          type: string
        status:
          type: string
        occurred_at:
          type: string
          format: date-time
        payload:
          type: object
          additionalProperties: true
    PickupCloseRequest:
      type: object
      description: Payload used to confirm store pickup.
      required:
        - code
      properties:
        code:
          type: string
          pattern: ^[0-9]{6}$
        collector:
          type: string
    PodVerifyRequest:
      type: object
      description: Proof of delivery verification payload.
      required:
        - code
      properties:
        code:
          type: string
          pattern: ^[0-9]{6}$
        recipient_name:
          type: string
    Policy:
      type: object
      description: Placeholder schema for Policy.
    PolicyUpdate:
      type: object
      description: Placeholder schema for PolicyUpdate.
    PricingProfiles:
      type: object
      description: Placeholder schema for PricingProfiles.
    PricingProfilesUpsert:
      type: object
      description: Placeholder schema for PricingProfilesUpsert.
    Problem:
      type: object
      description: RFC7807-compliant error envelope with service catalog codes.
      required:
        - type
        - title
        - status
        - code
        - traceId
      properties:
        type:
          type: string
          format: uri
          description: Machine-readable problem type URI.
        title:
          type: string
          description: Human-readable summary of the error condition.
        status:
          type: integer
          description: HTTP status code applied to the response.
        code:
          type: string
          description: Service-specific error code following {SERVICE}-{HTTP}-{KEY}.
          pattern: ^[A-Z]{3}-[0-9]{3}-[A-Z0-9\-]+$
        detail:
          type: string
          description: Additional context; must not contain raw PII.
        traceId:
          type: string
          description: Correlation identifier to link logs and traces.
        instance:
          type: string
          format: uri
          description: Optional URI reference to a support ticket or incident.
        errorCatalog:
          $ref: "#/components/schemas/ErrorCatalog"
        errors:
          type: array
          description: Field-level validation or domain errors.
          items:
            $ref: "#/components/schemas/ProblemDetail"
    ProblemDetail:
      type: object
      properties:
        field:
          type: string
          description: Field or entity associated with the error detail.
        message:
          type: string
          description: Localized, sanitized description safe for clients and logs.
    ErrorCode:
      type: string
      description: Application-specific standardized error code.
      pattern: ^[A-Z]{3}-[0-9]{3}-[A-Z0-9\-]+$
      example: SVR-500-UNEXPECTED
    ErrorCatalog:
      type: array
      description: Enumerated catalog of standard error codes relevant to the context.
      minItems: 1
      uniqueItems: true
      items:
        $ref: "#/components/schemas/ErrorCode"
    Promotion:
      type: object
      description: Placeholder schema for Promotion.
    PromotionCreate:
      type: object
      description: Placeholder schema for PromotionCreate.
    PromotionList:
      type: object
      description: Placeholder schema for PromotionList.
    QaRun:
      type: object
      description: Placeholder schema for QaRun.
    QaRunHistory:
      type: object
      description: Placeholder schema for QaRunHistory.
    QaRunList:
      type: object
      description: Placeholder schema for QaRunList.
    QueryList:
      type: object
      description: Placeholder schema for QueryList.
    QueryRunRequest:
      type: object
      description: Placeholder schema for QueryRunRequest.
    QueryRunResult:
      type: object
      description: Placeholder schema for QueryRunResult.
    QuoteRequest:
      type: object
      description: Request payload used by the customer web app to compute a Dark-Store quote.
      required:
        - channel
        - items
      properties:
        channel:
          type: string
          enum:
            - platform
            - partner
            - web
            - call_center
        items:
          type: array
          items:
            $ref: "#/components/schemas/OrderItemRequest"
          minItems: 1
        delivery_address:
          $ref: "#/components/schemas/Address"
        slot_preference:
          type: object
          properties:
            desired_start:
              type: string
              format: date-time
            desired_end:
              type: string
              format: date-time
            flexible:
              type: boolean
              default: true
        customer:
          $ref: "#/components/schemas/ContactReference"
        metadata:
          type: object
          additionalProperties:
            type: string
    QuoteResponse:
      type: object
      description: Quote response containing pricing breakdown and available slots.
      required:
        - quote_id
        - expires_at
        - pricing
      properties:
        quote_id:
          type: string
        expires_at:
          type: string
          format: date-time
        pricing:
          $ref: "#/components/schemas/PricingBreakdown"
        slot_options:
          type: array
          items:
            $ref: "#/components/schemas/SlotWindow"
        currency:
          type: string
          minLength: 3
          maxLength: 3
        items:
          type: array
          items:
            $ref: "#/components/schemas/OrderItem"
    ReassignOrderRequest:
      type: object
      description: Placeholder schema for ReassignOrderRequest.
    Receipt:
      type: object
      description: Final receipt presented after fulfillment.
      properties:
        order_id:
          type: string
        issued_at:
          type: string
          format: date-time
        items:
          type: array
          items:
            $ref: "#/components/schemas/OrderItem"
        pricing:
          $ref: "#/components/schemas/PricingBreakdown"
        payment_method:
          type: string
        tax_receipt_number:
          type: string
    ReceiptIssueRequest:
      type: object
      description: Placeholder schema for ReceiptIssueRequest.
    ReconcileRunRequest:
      type: object
      description: Placeholder schema for ReconcileRunRequest.
    ReconcileRunResult:
      type: object
      description: Placeholder schema for ReconcileRunResult.
    RegistryPatch:
      type: object
      description: Placeholder schema for RegistryPatch.
    RegistryPatchResult:
      type: object
      description: Placeholder schema for RegistryPatchResult.
    RejectOrderRequest:
      type: object
      description: Placeholder schema for RejectOrderRequest.
    RejectRequest:
      type: object
      description: Placeholder schema for RejectRequest.
    ReorderRequest:
      type: object
      description: Placeholder schema for ReorderRequest.
    Report:
      type: object
      description: Placeholder schema for Report.
    ReportCreateRequest:
      type: object
      description: Placeholder schema for ReportCreateRequest.
    ReportGenRequest:
      type: object
      description: Placeholder schema for ReportGenRequest.
    ReportList:
      type: object
      description: Placeholder schema for ReportList.
    ReviewTicket:
      type: object
      description: Placeholder schema for ReviewTicket.
    RunGuardsRequest:
      type: object
      description: Placeholder schema for RunGuardsRequest.
    RuntimeVar:
      type: object
      description: Placeholder schema for RuntimeVar.
    RuntimeVarList:
      type: object
      description: Placeholder schema for RuntimeVarList.
    RuntimeVarUpsertRequest:
      type: object
      description: Placeholder schema for RuntimeVarUpsertRequest.
    RuntimeVars:
      type: object
      description: Placeholder schema for RuntimeVars.
    RuntimeVarsPatch:
      type: object
      description: Placeholder schema for RuntimeVarsPatch.
    SLABreachList:
      type: object
      description: Placeholder schema for SLABreachList.
    SSOTIndex:
      type: object
      description: Placeholder schema for SSOTIndex.
    SSOTIndexUpdate:
      type: object
      description: Placeholder schema for SSOTIndexUpdate.
    Settlement:
      type: object
      required:
        - id
        - status
        - currency
        - total_amount
        - created_at
      properties:
        id:
          type: string
        status:
          type: string
          enum:
            - draft
            - pending_approval
            - approved
            - rejected
            - paid
        currency:
          type: string
          minLength: 3
          maxLength: 3
        total_amount:
          $ref: "#/components/schemas/MoneyValue"
        period_start:
          type: string
          format: date-time
        period_end:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time
        approved_at:
          type: string
          format: date-time
          nullable: true
        notes:
          type: string
    SettlementApproveRequest:
      type: object
      properties:
        decision_note:
          type: string
        second_signer:
          type: string
          description: Identifier for dual-sign policy.
    SettlementBatch:
      type: object
      description: Placeholder schema for SettlementBatch.
    SettlementCreateRequest:
      type: object
      required:
        - period_start
        - period_end
      properties:
        period_start:
          type: string
          format: date
        period_end:
          type: string
          format: date
        description:
          type: string
    SettlementList:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/Settlement"
        next_cursor:
          type: string
          nullable: true
    Shift:
      type: object
      description: Placeholder schema for Shift.
    ShiftAssignRequest:
      type: object
      description: Placeholder schema for ShiftAssignRequest.
    ShiftAssignment:
      type: object
      description: Placeholder schema for ShiftAssignment.
    ShiftList:
      type: object
      description: Placeholder schema for ShiftList.
    SignedUrlRequest:
      type: object
      description: Placeholder schema for SignedUrlRequest.
    SignedUrlResponse:
      type: object
      description: Placeholder schema for SignedUrlResponse.
    Slot:
      type: object
      description: Placeholder schema for Slot.
    SlotList:
      type: object
      description: Placeholder schema for SlotList.
    SlotUpdateRequest:
      type: object
      description: Placeholder schema for SlotUpdateRequest.
    SlotUpsertRequest:
      type: object
      description: Placeholder schema for SlotUpsertRequest.
    SmsInboundWebhook:
      type: object
      description: Placeholder schema for SmsInboundWebhook.
    SmsTestRequest:
      type: object
      description: Placeholder schema for SmsTestRequest.
    Snapshot:
      type: object
      description: Placeholder schema for Snapshot.
    SnapshotCreate:
      type: object
      description: Placeholder schema for SnapshotCreate.
    Store:
      type: object
      description: Placeholder schema for Store.
    StoreCreate:
      type: object
      description: Placeholder schema for StoreCreate.
    StoreHours:
      type: object
      description: Placeholder schema for StoreHours.
    StoreHoursUpdate:
      type: object
      description: Placeholder schema for StoreHoursUpdate.
    StoreList:
      type: object
      description: Placeholder schema for StoreList.
    StoreUpdate:
      type: object
      description: Placeholder schema for StoreUpdate.
    StoreZones:
      type: object
      description: Placeholder schema for StoreZones.
    StoreZonesSet:
      type: object
      description: Placeholder schema for StoreZonesSet.
    SubmitReview:
      type: object
      description: Placeholder schema for SubmitReview.
    SubscriberImportRequest:
      type: object
      description: Placeholder schema for SubscriberImportRequest.
    SubscriberList:
      type: object
      description: Placeholder schema for SubscriberList.
    TagsUpdateRequest:
      type: object
      description: Placeholder schema for TagsUpdateRequest.
    Ticket:
      type: object
      description: Placeholder schema for Ticket.
    TicketList:
      type: object
      description: Placeholder schema for TicketList.
    TicketStatusUpdate:
      type: object
      description: Placeholder schema for TicketStatusUpdate.
    Timesheet:
      type: object
      description: Placeholder schema for Timesheet.
    TimesheetDecisionRequest:
      type: object
      description: Placeholder schema for TimesheetDecisionRequest.
    TimesheetList:
      type: object
      description: Placeholder schema for TimesheetList.
    TrackingInfo:
      type: object
      description: Tracking snapshot presented to the customer UI.
      properties:
        current_status:
          type: string
        estimated_arrival:
          type: string
          format: date-time
          nullable: true
        captain_location:
          $ref: "#/components/schemas/GeoPoint"
        timeline:
          type: array
          items:
            $ref: "#/components/schemas/TimelineEvent"
    UnmaskApproval:
      type: object
      description: Placeholder schema for UnmaskApproval.
    UnmaskRequest:
      type: object
      description: Placeholder schema for UnmaskRequest.
    UnmaskTicket:
      type: object
      description: Placeholder schema for UnmaskTicket.
    UserInvite:
      type: object
      description: Placeholder schema for UserInvite.
    UserInviteResult:
      type: object
      description: Placeholder schema for UserInviteResult.
    WhatsAppInboundWebhook:
      type: object
      description: Placeholder schema for WhatsAppInboundWebhook.
    WhatsAppTestRequest:
      type: object
      description: Placeholder schema for WhatsAppTestRequest.
    MoneyValue:
      type: object
      description: Monetary value expressed in the smallest unit for the given ISO-4217 currency.
      required:
        - amount
        - currency
      properties:
        amount:
          type: integer
          minimum: 0
          description: Amount in minor units (e.g. fils).
        currency:
          type: string
          minLength: 3
          maxLength: 3
          description: ISO-4217 currency code (YER by default).
    GeoPoint:
      type: object
      description: Geographic point used for delivery or pickup locations.
      required:
        - lat
        - lon
      properties:
        lat:
          type: number
          minimum: -90
          maximum: 90
        lon:
          type: number
          minimum: -180
          maximum: 180
    ContactReference:
      type: object
      description: Minimal contact reference for customers, partners, or captains.
      properties:
        id:
          type: string
          description: Internal identifier for the contact.
        full_name:
          type: string
        phone:
          type: string
          pattern: ^[0-9+\- ]{5,20}$
        email:
          type: string
          format: email
      required:
        - full_name
    Address:
      type: object
      description: Delivery or pickup address captured during ordering.
      properties:
        city:
          type: string
        district:
          type: string
        street:
          type: string
        building:
          type: string
        unit:
          type: string
          description: Apartment or suite number.
        notes:
          type: string
        location:
          $ref: "#/components/schemas/GeoPoint"
    OrderItemRequest:
      type: object
      description: Item entry used when composing an order or quote request.
      required:
        - sku
        - quantity
      properties:
        sku:
          type: string
          description: Stock keeping unit / catalog identifier.
        name:
          type: string
          description: Display name presented to the customer.
        quantity:
          type: integer
          minimum: 1
        unit_price:
          $ref: "#/components/schemas/MoneyValue"
        addons:
          type: array
          items:
            type: string
          description: Optional addon identifiers.
        notes:
          type: string
    OrderItem:
      type: object
      description: Item representation stored with the order after pricing.
      required:
        - sku
        - name
        - quantity
        - total_price
      properties:
        sku:
          type: string
        name:
          type: string
        quantity:
          type: integer
          minimum: 1
        unit_price:
          $ref: "#/components/schemas/MoneyValue"
        discount:
          $ref: "#/components/schemas/MoneyValue"
        total_price:
          $ref: "#/components/schemas/MoneyValue"
        addons:
          type: array
          items:
            type: string
    SlotWindow:
      type: object
      description: Delivery or pickup slot assigned to an order.
      required:
        - id
        - start_at
        - end_at
      properties:
        id:
          type: string
        type:
          type: string
          enum:
            - delivery
            - pickup
            - dark_store
        start_at:
          type: string
          format: date-time
        end_at:
          type: string
          format: date-time
        capacity:
          type: integer
          minimum: 0
    TimelineEvent:
      type: object
      description: Status change recorded against an order timeline.
      required:
        - code
        - label
        - occurred_at
      properties:
        code:
          type: string
          description: Machine-readable event code (e.g. PREPARING, ON_ROUTE).
        label:
          type: string
        occurred_at:
          type: string
          format: date-time
        actor:
          type: string
          description: Actor that triggered the event.
        notes:
          type: string
    PricingBreakdown:
      type: object
      description: Breakdown of pricing elements returned in quotes and orders.
      properties:
        items_subtotal:
          $ref: "#/components/schemas/MoneyValue"
        delivery_fee:
          $ref: "#/components/schemas/MoneyValue"
        discount:
          $ref: "#/components/schemas/MoneyValue"
        tax:
          $ref: "#/components/schemas/MoneyValue"
        total:
          $ref: "#/components/schemas/MoneyValue"
    ZonePolygon:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        coordinates:
          type: array
          items:
            type: array
            items:
              type: array
              items:
                type: number
              minItems: 2
              maxItems: 2
    PaymentIntentCreateRequest:
      type: object
      additionalProperties: false
      required:
        - amount
        - currency
        - order_reference
      properties:
        amount:
          type: integer
          minimum: 1
          description: قيمة الطلب بالعملة الأساسية (YER افتراضيًا).
        currency:
          type: string
          minLength: 3
          maxLength: 3
          description: رمز العملة على ISO-4217 (YER افتراضيًا).
        order_reference:
          type: string
          maxLength: 64
          description: معرّف الطلب في الخدمة المستهلكة (مثل DSH).
        customer_id:
          type: string
          maxLength: 64
          description: معرّف المستخدم داخل النظام.
        metadata:
          type: object
          additionalProperties: true
          description: حقول إضافية للتكامل (بريد، قناة، سياق).
    PaymentConfirmationRequest:
      type: object
      additionalProperties: false
      required:
        - provider_payload
      properties:
        provider_payload:
          type: object
          additionalProperties: true
          description: الرد الأصلي من مزود PSP بعد تنفيذ الدفع.
        reconciliation_reference:
          type: string
          description: رقم المرجع للمصالحة المالية إذا توفر.
    WltRefundWebhook:
      type: object
      additionalProperties: false
      required:
        - event
        - signature
        - issued_at
        - data
      properties:
        event:
          type: string
          enum:
            - refund.succeeded
            - refund.failed
            - chargeback.opened
            - chargeback.closed
        signature:
          type: string
          description: التوقيع الرقمي المولّد عبر المفتاح السري المشترك.
        issued_at:
          type: string
          format: date-time
        data:
          type: object
          additionalProperties: true
          description: الحمولة التفصيلية للحدث (مبلغ، intent_id، تفاصيل PSP).
x-generated-at: 2025-11-14T04:00:30.362Z
